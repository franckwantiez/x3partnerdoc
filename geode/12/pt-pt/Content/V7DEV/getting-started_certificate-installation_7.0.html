<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="pt-pt" xml:lang="pt-pt" class="_Skins_Sage_Skin_SideNav" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <meta charset="utf-8" />
        <meta name="description" content="Certificate installation_7.0" />
        <meta name="module" content="Platform" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" /><title> Certificate installation_7.0
</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/Sage.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/Stylesheets/font-awesome.css" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: #000000 url('../../Skins/Default/Stylesheets/Images/60x60_globe_white-on-transparent_icon.png') no-repeat center center;
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../Resources/TableStyles/NormalRows.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <script type="text/javascript">/*<![CDATA[*/


function onload(){
	window.focus();
	window[window.history.pushState ? "onpopstate" : "onhashchange"] = function(event){ windows.focus(); };
}


/*]]>*/</script>
        <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Voltar" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Ir para conteúdo principal</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Conta</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Definições</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Terminar sessão</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Mostrar painel de navegação" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Home.htm" alt="Logótipo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Conta</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Definições</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Terminar sessão</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Campo de pesquisa" placeholder="Pesquisar" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filtro:</span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Filtro de pesquisa" title="Todos os ficheiros" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">Todos os ficheiros</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Pesquisar" role="button" tabindex="0"><span class="invisible-label">Enviar pesquisa</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <script type="text/javascript">/*<![CDATA[*/$(document).ready(function(){
			$("#selectlang").appendTo("div.central-account-wrapper");
		});/*]]>*/</script>
                                    <div id="selectlang" class="headerlang">
                                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_Language_toggle mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                            <div class="button-group-container-left">
                                                <button class="button needs-pie select-language-button" title="Alterar idioma">
                                                    <div>
                                                        <div role="img" class="button-icon-wrapper" aria-label="Alterar idioma">
                                                            <div class="button-icon"> </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="sage-header-title">
                                        <img id="sage-header-logo" src="../Resources/Images/Sage_logo_green.svg" alt="Sage" /><span id="sage-header-product-name"><span id="sage-header-product"><span class="mc-variable Sage-Product.ProductName variable">X3 Warehousing</span></span></span>
                                    </div>
                                    <section class="sage-topic-body sage-layout-two-columns">
                                        <div class="sage-layout-topic-main">
                                            <div role="main" id="mc-main-content">
                                                <h1 id="Certificateinstallation70" data-magellan-target="Certificateinstallation70"> Certificate installation_7.0
</h1>
                                                <p><strong>The trusted connection between node servers and Sage X3 servers is based on signed certificates. This document explains how the certificates must be set up and installed, and includes the following sections:</strong>
                                                </p>
                                                <p><b><ul><br /> <li><a href="#introduction-about-certificates">Introduction about certificates</a></li><br /> <li><a href="#simplified-certificate-procedure">Simplified certificate procedure</a></li><br /> <li><a href="#complete-generation-procedure">Complete generation procedure</a></li><br /> <li><a href="#appendix-detailed-generation-procedure">Appendix: Detailed generation procedure</a></li><br /></ul></b>
                                                </p>
                                                <h1 id="Introductionaboutcertificates" data-magellan-target="Introductionaboutcertificates"><a id="introduction-about-certificates">Introduction about certificates</a>
                                                </h1>
                                                <h2 id="Whatisapublickeyaprivatekeyacertificateandapassphrase" data-magellan-target="Whatisapublickeyaprivatekeyacertificateandapassphrase">What is a public key, a private key, a certificate, and a passphrase?</h2>
                                                <p>In normal cryptography, anyone who encrypts something can also decrypt it because the same key is used for both encryption and decryption.<br /></p>
                                                <p>In public key cryptography there is:</p>
                                                <ul> A <strong><em>public key</em></strong>, which can be distributed to many people. <br />A <strong><em>private key</em></strong>, which should be kept private.</ul><b> Only the holder of the private key can decrypt data which has been encrypted using the public key.</b>
                                                <p>A similar process is used for <strong><em>digital signatures</em></strong> to secure some data. For this purpose, you can compute the digital signature (some kind of encrypted summary) of the data using the private key. Anyone who has the public key can verify the digital signature of the data and thus make sure that the data has not been changed. It is almost impossible to change the data without changing the signature, and to compute a valid signature of some data without the private key.</p>
                                                <p>The private key is very sensitive and usually encrypted using a <strong><em>passphrase</em></strong> (similar to a password, but complex). You can use the private key only if you know the passphrase.</p>
                                                <p>A <strong><em>certificate</em></strong> is like a bundle of a public key with additional data and a digital signature. There are always two parties involved: a <strong><em>subject</em></strong> and an <strong><em>issuer</em></strong>.</p>
                                                <ul> <b>The subject</b> (a person or organization) provides the public key and most of the additional data. <br /><b>The issuer</b> essentially seals the data with a digital signature.</ul>
                                                <p>A certificate is a file that contains information about the issuer and the subject of the certificate, an expiration date, the subject's public key, and the issuer's digital signature to verify that the certificate is not fake (you need the issuer's certificate or public key to verify it). When you use a certificate, you should trust the issuer of the certificate.</p>
                                                <p>When you have the certificate, you can verify that the subject of the certificate has the corresponding private key.</p>
                                                <p>This schema summarizes the components that are set up for a certificate management:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_certificate_principles.jpg" />
                                                </p>
                                                <h2 id="Howdocertificatesoperate" data-magellan-target="Howdocertificatesoperate">How do certificates operate?</h2>
                                                <p>Certificates are managed as follows:</p>
                                                <h2 id="Mastercertificate" data-magellan-target="Mastercertificate">Master certificate</h2>
                                                <p>In the first step, a master certificate or "CA certificate" is created. This master certificate is used as a "certification authority" (the issuer and subject are the same). It identifies a domain of trust for your company or organization.</p>
                                                <p>For a strong security, this certificate should be generated on a secured server, and the private key MUST NOT BE TRANSFERRED anywhere. However, the master certificate will be transferred on different node.js servers as illustrated on the following schema:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_certificate_master.jpg" />
                                                </p>
                                                <p>In this schema, the number (1) means that only one master certificate exists, and the corresponding private key is kept safe on a master secured server, while the certificate is distributed on every node.js server.</p>
                                                <h2 id="nodejscertificate" data-magellan-target="nodejscertificate">node.js certificate</h2>
                                                <p>The second step is to create a private and public key, and a certificate for every node.js server. They are generated using the master certificate and master private key, thus the <strong>issuer</strong> is the above "certification authority" and the <strong>subject</strong> is the node.js server. This step secures the connections to Sage X3 and may also secure connections between node.js servers. Every time a connection request is sent from a node.js server to a Sage X3 server, encrypted data is sent. The Sage X3 server is able, by using the public key, to identify the server that connects to it, and ensures the authentication. This is why we have as many certificates as node.js servers. This information corresponds to the following schema:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_certificate_syracuse.jpg" />
                                                </p>
                                                <p>In this schema, the letter (N) means that there are as many certificates and private keys as node.js servers. The private key and certificate will remain on the node.js server, while the public key will be distributed to the Sage X3 servers that will receive a connection from the corresponding node.js server. Note that the Sage X3 servers will only get the public key, without the certificate itself (which also contains the same public key and some other information), or the private key.</p>
                                                <h1 id="Simplifiedcertificateprocedure" data-magellan-target="Simplifiedcertificateprocedure"><a id="simplified">Simplified certificate procedure</a>
                                                </h1>
                                                <h2 id="Whyisacompleteautomationimpossible" data-magellan-target="Whyisacompleteautomationimpossible">Why is a complete automation impossible?</h2>
                                                <p>For security reasons, it is impossible to completely automate the generation and distribution of certificates and keys because each server needs some trusted piece of information to check and trust another server. However, there is a simplified method where the installation can be automated. If a unique node.js server is present on the network, the generation of the CA certificate and the unique node.js certificate can be done in a completely automated method by the installation procedure. In addition, if the Sage X3 server is located on the same physical server, you can directly copy the key in Sage X3.</p>
                                                <h2 id="Usingthesimplifiedprocedure" data-magellan-target="Usingthesimplifiedprocedure">Using the simplified procedure</h2>
                                                <p>The simplified procedure has been created to handle all cases where a unique node.js server is installed on the network.</p>
                                                <ul>
                                                    <li>This server also generates the CA certificate and private key.</li>
                                                    <li>The node.js certificate and public and private keys are also generated on this same server.</li>
                                                    <li>If an additional check box is selected that communicates that the Sage X3 server is located on a server accessible through the network, the public key is copied automatically. Otherwise, the transfer will have to be done manually after running the procedure.</li>
                                                </ul>
                                                <p>If you want a separate server that creates certificates in a secured environment, you need to run the <a href="#complete-generation-procedure">complete generation procedure</a>.</p>
                                                <h2 id="Thesimplifiedgenerationkeyprocedure" data-magellan-target="Thesimplifiedgenerationkeyprocedure"><a id="keygeneration"></a>The simplified generation key procedure</h2>
                                                <p>The key generation procedure is included within the software installation procedure. This section describes the installation steps involved with the key generation. The following screens have been shrunk to display only the useful information.</p>
                                                <p>The first step regarding the key generation starts on step 9 of 18. The following screen appears:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_install_9.jpg" />
                                                </p>
                                                <p>The following information is provided:</p>
                                                <ul>
                                                    <li>The path where the certificate is stored for the server certificate.</li>
                                                    <li>The "Simplified certificate installation" check box is selected to use this procedure.</li>
                                                </ul>
                                                <p>If the check box is selected, the following screen appears:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_install_10.jpg" />
                                                </p>
                                                <p>This screen requires you to enter a passphrase for the private key of the certification authority and another passphrase for the server certificate. A passphrase is the equivalent of a password that must be long and where digits, upper case, lower case, and special characters should be mixed to ensure maximum security. You should memorize these passphrases because it will be impossible to recover them.</p>
                                                <p>Both passphrases must be entered twice.</p>
                                                <p>The next two screens require information about the issuer of certificates. They both need the same information to be entered.</p>
                                                <ul>
                                                    <li>The first screen requires the information for the CA certificate.</li>
                                                    <li>The second screen requires the information for the server certificate. </li>
                                                </ul>
                                                <p>The screens are similar to the following screen:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_install_11.jpg" />
                                                </p>
                                                <p>The data required for a certificate are: <strong><em>the country and state (if necessary), city, organization, service, name, and validity duration in days</em></strong>. Note that when the duration expires, you will have to recreate the different certificates and distribute them. For this reason, you have to choose the best compromise between security (everlasting certificate is not very secured) and convenience (recreating and deploying certificates will be done with the manual procedure).</p>
                                                <p>The data entered for the CA certificate can be different from the data for the server certificate. The details for the CA certificate should identify the global organization that you have to trust when you create new certificates. For example, it can be your company or the group it belongs to if the certificate delivery is done for several node.js instances. The details of the server certificate can be related to a local suborganization that handles the node.js server.</p>
                                                <p>The next screen associated with the certificate generation is the following:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_install_12a.jpg" />
                                                </p>
                                                <p>In this screen, you define the folder where the certificate generation tool is installed. You can change the default path. This path is used to manually generate other certificates in a later step.</p>
                                                <p>This screen also includes a check box to specify a local Sage X3 runtime if there is one. This happens if a unique physical server hosts the node.js server and the Sage X3 runtime. When this check box is selected, the following screen appears:</p>
                                                <p>
                                                    <img src="../Resources/Images/images_install_12b.jpg" />
                                                </p>
                                                <p>The runtime path must be provided, and automatically copies the public key into the correct folder.</p>
                                                <p>If the "Specify an X3 Runtime path and install certificates" check box is cleared, a warning message appears informing you to copy the public key at a later time.</p>
                                                <p>
                                                    <img src="../Resources/Images/images_install_13.jpg" />
                                                </p>
                                                <h2 id="Finalstep" data-magellan-target="Finalstep"><a id="finalstep"></a>Final step</h2>
                                                <p>The next installation procedure screens are not related to the key generation.</p>
                                                <p>When these steps are completed, the system is ready to be used. The additional steps related to certificate in simplified procedure no longer exist.</p>
                                                <h1 id="Completegenerationprocedure" data-magellan-target="Completegenerationprocedure"><a id="complete-generation-procedure">Complete generation procedure</a>
                                                </h1>
                                                <p>If the simplified generation procedure is not selected, you have to manually create and install the certificates and public and private keys to ensure a secured connection between the different servers. This chapter describes the procedure.</p>
                                                <h2 id="Generatingcertificates" data-magellan-target="Generatingcertificates">Generating certificates</h2>
                                                <p>You need a computer to generate certificates which are used for secured communication and authentication of the servers. These certificates and private keys contain sensitive data; therefore, this computer should be secured without Internet access, if possible. It is not necessary that this physical computer belongs to the node.js cluster.</p>
                                                <p>To do this, you need to copy the contents of the folder <code>bin/cert_gen</code> (at least the following files: <code>bcpkix-jdk15on-150.jar</code>, <code>bcprov-jdk15on-150.jar</code>, <code>certgen.jar</code>, and <code>certgen.bat</code>) of an arbitrary node.js installation into one folder of the file system for this computer.</p>
                                                <p>Java 7 must be installed on that computer, and Java must be in the search path for executables.</p>
                                                <p>To generate the certificates, you may invoke on the command line (within that folder)<br /><code>java -jar certgen.jar</code>. Under Microsoft Windows, click <code>certgen.bat</code>, which invokes this command line. The user who executes the program must have write access to the folder and subfolders. The program creates subfolders <code>private</code> (for the private key of the generated certificate authority) and <code>output</code> (for all other certificates, server private keys, and public keys).</p>
                                                <p>When you run the program for the first time, it creates these subfolders and asks for data of the generated certificate authority which is used to sign all server certificates. After that, you can create an arbitrary number of certificates.</p>
                                                <p>There must be a certificate for each server in which node.js runs. The name must be the hostname of the node.js server. It must be the same as the output of the <code>hostname</code> command on that server, and it is automatically converted to lowercase. The program asks you for the server name of the TCP connections. This must be the server name or IP address in which this server can be reached by TCP from <em>all</em> other node.js servers (for example, hostname with domain).</p>
                                                <p>If you generate the certificates on a computer which has network connection to the node.js servers, you may also automatically transfer the certificates if you have already copied the CA certificate to each server.</p>
                                                <p>For a complete list of program options, see the <a href="#appendix-detailed-generation-procedure">appendix</a><br />section. </p>
                                                <p>At the end, the output subfolder will contain the following files:<br />- <code>ca.cacrt</code>, the certificate of the generated certification authority.<br />- The following three files for each server. The name is always the hostname of the server (in lowercase):<br />    * The file with extension <code>.crt</code> contains the certificate of that server. <br />    * The file with extension <code>.key</code> contains the private key for this server. <br />    * The file with extension <code>.pem</code> contains the corresponding public key which is used by Sage X3 servers for communication with this server. Note that in the name of the <code>.pem</code> file, the characters <code>$</code>, <code>.</code>, and <code>@</code> have been replaced with <code>_</code>.</p>
                                                <h2 id="Distributionofcertificatestonodejsservers" data-magellan-target="Distributionofcertificatestonodejsservers">Distribution of certificates to node.js servers</h2>
                                                <p>The setup has created a folder for certificates on each server. Within this folder, there is a subfolder whose name is the server name. Under Unix, only the subfolder where the node.js process runs is accessible by the user. Copy the files <code>ca.cacrt</code> into this subfolder.</p>
                                                <p>If you do not want to transfer the certificate, private key, and passphrase using the certificate generation tool, you must also copy manually the files with extensions <code>.key</code> and <code>.crt</code>, whose name is the server name, into this subfolder. Moreover, the passphrase must be set. In the node.js installation folder, you can find the batch file <code>passphrase.cmd</code> or the shell script <code>passphrase.sh</code> which can set the passphrase. You must invoke this file with one parameter (the passphrase of the private key) on the command line. This sets and encrypts the passphrase, and checks the certificate and private key. The encryption of the passphrase depends on the computer and the operating system user. Therefore, the command writes the passphrase for the user in which the node.js process runs.</p>
                                                <p>You can check your settings by invoking the passphrase file with the special parameter <code>-check</code>. This does not set a passphrase, but only reports the integrity of the certificate and private key.</p>
                                                <p>Remark: You cannot set the value <code>-check</code> as a passphrase for a server key. A passphrase must include at least four characters.</p>
                                                <p>The passphrase command automatically contacts the node.js server to update its configuration so that you do not have to restart the node.js server.</p>
                                                <p>When everything is OK, you can start the administration application. In the Hosts entity, make sure that all hosts have the status <code>OK</code> and the <code>security</code> check box is selected. </p>
                                                <h2 id="DistributionofpublickeystotheSageX3server" data-magellan-target="DistributionofpublickeystotheSageX3server">Distribution of public keys to the Sage X3 server</h2>
                                                <p>Each node.js server has to authenticate against each Sage X3 server it invokes. You have two options:</p>
                                                <ol>
                                                    <li value="1">
                                                        <p><strong>For the x3server entity with some certificates declared.</strong> This must be a certificate with a private key and must not be any of the previously manually installed internal certificates for node.js servers. You can also generate this new certificate by using the certificate generation tool and install it on all node.js servers by adding a new instance of the certificate entity. You must copy the public key file (with extension <code>.pem</code>) for this certificate into the <code>keys</code> subfolder of the Sage X3 runtime. Note that the characters <code>$</code>, <code>.</code>, and <code>@</code> in the certificate name is replaced with <code>_</code>.<br />For example: When the name of the instance of the certificate entity is <code>test.test</code>, there must be a file <code>test_test.pem</code> in the <code>keys</code> directory.</p>
                                                    </li>
                                                    <li value="2">
                                                        <p><strong>For the x3server entity with no certificates declared.</strong> The manually installed server certificate of this node.js server is used. This means that you must copy all public keys of the node.js servers (all <code>.pem</code> files of the output folder of the certificate generation tool) into the <code>keys</code> subfolder of the Sage X3 runtime. When you add a node.js server later on, you also must copy its public key (the <code>.pem</code> file) into the <code>keys</code> subfolder of all Sage X3 runtimes. Note that in the <code>.pem</code> file, the characters <code>$</code>, <code>.</code>, and <code>@</code> of the hostname are replaced with <code>_</code> to build the name of the <code>.pem</code> file. For example: For the server <code>ABC.DEF.GHI</code>, the file will be <code>abc_def_ghi.pem</code>.</p>
                                                    </li>
                                                </ol>
                                                <p>Let's just illustrate this last option by using an example where you have two node servers (A and B), and two Sage X3 servers (1 and 2). If you want the Sage X3 server 1 to accept connections from both node.js servers (A and B), and Sage X3 server 2 to accept connections only from node.js server A, the deployment policy is summarized in the following table, where:</p>
                                                <ul>
                                                    <li><strong>Yes</strong> means the file must be installed.</li>
                                                    <li><strong>Yes/Transfer</strong> means the file must be installed unless you use the certificate generation tool to transfer this data.</li>
                                                    <li><strong>No</strong> means the file must not be installed.</li>
                                                    <li><strong>Never</strong> means installing the corresponding file would create a critical security breach.</li>
                                                    <li><strong>Generated</strong> means the file is generated there and should remain for certificate evolution purposes only.</li>
                                                    <li><strong>Available</strong> means the file is generated there and must remain there.</li>
                                                </ul>
                                                <table style="mc-table-style: url('../Resources/TableStyles/NormalRows.css');" class="TableStyle-NormalRows" cellspacing="0">
                                                    <tr class="TableStyle-NormalRows-Body-Body2">
                                                        <th rowspan="2" width="20%" class="TableStyle-NormalRows-BodyE-Column1-Body2">Type of file</th>
                                                        <th colspan="5" class="TableStyle-NormalRows-BodyD-Column1-Body2">Installed on</th>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body1">
                                                        <th class="TableStyle-NormalRows-BodyE-Column1-Body1">Secured CA server</th>
                                                        <th class="TableStyle-NormalRows-BodyE-Column1-Body1">node.js server A</th>
                                                        <th class="TableStyle-NormalRows-BodyE-Column1-Body1">node server B</th>
                                                        <th class="TableStyle-NormalRows-BodyE-Column1-Body1">Sage X3 server 1</th>
                                                        <th class="TableStyle-NormalRows-BodyD-Column1-Body1">Sage X3 server 2</th>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body2">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">CA certificate</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">available</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">yes</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">yes</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">no</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body2">no</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body1">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">CA private key</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">available</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">never</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">never</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">never</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body1">never</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body2">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">Certificate for server A</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">generated</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">yes/transfer</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">no</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">no</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body2">no</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body1">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">Server A private key</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">generated</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">yes/transfer</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">never</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">never</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body1">never</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body2">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">Server A public key</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">generated</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">no</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">no</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">yes</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body2">yes</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body1">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">Certificate for server B</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">generated</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">no</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">yes/transfer</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">no</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body1">no</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body2">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">Server B private key</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">generated</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">never</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">yes/transfer</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body2">never</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body2">never</td>
                                                    </tr>
                                                    <tr class="TableStyle-NormalRows-Body-Body1">
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">Server B public key</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">generated</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">no</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">no</td>
                                                        <td class="TableStyle-NormalRows-BodyE-Column1-Body1">yes</td>
                                                        <td class="TableStyle-NormalRows-BodyD-Column1-Body1">no</td>
                                                    </tr>
                                                </table>
                                                <h1 id="AppendixDetailedgenerationprocedure" data-magellan-target="AppendixDetailedgenerationprocedure"><a id="appendix-detailed-generation-procedure"></a>Appendix: Detailed generation procedure</h1>
                                                <p>Certificates, private keys, and their passphrases are sensitive data which are important for securing connections and for signing documents. Therefore, they will not be stored in the database but placed as files in the local file system in a folder with limited access rights. The encrypted passphrases will be added to another file in the same folder.</p>
                                                <p>There will be a system of customer generated certificates and private keys which will ensure that the servers are able to trust each other, and be trustworthy to the Sage X3 runtime. These certificates will be signed using a customer generated certification authority. The node.js servers will have the certificate and the private key, while the Sage X3 runtime will have only the certificates of the servers calling the Sage X3 runtime. In the future, only the certificate of the customer generated certification authority may be added to the Sage X3 runtime so that it has to verify the certificates of the node.js servers.</p>
                                                <p>At the customer site, the administrator generates a private key and a self-signed certificate which acts as a certification authority. For each server in the cluster, a certificate and a private key is generated in such a way that the certificate can act as a server certificate for HTTPS. The certificates are signed using the previously generated self-signed certificate. </p>
                                                <h2 id="Generatingcertificates1" data-magellan-target="Generatingcertificates1">Generating certificates</h2>
                                                <p>For this purpose, the administrator uses a command line tool. The tool is independent from the node.js installation folders, and should run on a different computer. You should copy all contents of the <code>cert_gen</code> subfolder of the customer image into an empty folder. <br />A Java runtime (Java version 7 and above) must be available on the computer and in the search path for binaries.</p>
                                                <p>On a Microsoft Windows operating system, you can invoke <code>certgen.bat</code> without opening a command line to start the tool without command line parameters. You can also add command line parameters to <code>certgen.bat</code>.<br />Otherwise, you can invoke <code>java -jar certgen.jar</code> and add command line parameters.</p>
                                                <p>The application creates two subfolders <code>private</code> and <code>output</code> (see "First Invocation" below). After generation, the CA certificate, the server certificate, and the corresponding private key must be manually copied to each server that runs the 'node.js' processes. The server certificates must be copied to servers having the Sage X3 runtime with the help of the administration GUI. It can be used for several actions within one interactive session (where the passphrase of the CA private key is re-used). </p>
                                                <p><strong>The following is a list of possible use cases for the tool:</strong>
                                                </p>
                                                <ul>
                                                    <li>The tool can be invoked with and without command line parameters, and will fetch the missing data from the console unless the <code>-batch</code> switch is set. </li>
                                                    <li>When the <code>-batch</code> switch is set, there is no input from the console and an error appears when data is missing. This switch is recommended when you use the tool within batch files.</li>
                                                    <li>You can generate the certificate, public key, and private key files and copy them manually to the node.js servers. This is the most secure option because you can generate the certificates on a computer that is not part of any network. If there is a network connection from the computer in which the tool runs to the node.js servers, it may be easier. The tool can transfer the server's certificate, private key, and passphrase to a node.js server using HTTP requests with encrypted data (it uses the certificate's subject's common name as the address which is entered as the server name for TCP connections; no HTTPS is possible). To use this, the CA certificate must have been manually copied to the node.js servers because the node.js servers need it to check whether they can trust the data. If you do not want to do this, you can add a <code>-notransfer</code> switch to the invocation of the tool to switch off all transfer options. When node.js cannot be reached, the tool stops with an error message. When the <code>-wait</code> option is set together with a positive number (for example, <code>-wait 20</code>), the tool will try numerous times to connect to this port for this number of seconds. When you specify the <code>-port</code> switch together with a positive number (for example, <code>-port 8124</code>), the tool will transfer the data to the node.js server even in batch mode.</li>
                                                </ul>
                                                <h2 id="FirstInvocation" data-magellan-target="FirstInvocation">First Invocation</h2>
                                                <p>When the tool is started for the first time, it creates two folders: </p>
                                                <ol>
                                                    <li value="1">An <code>output</code> folder for the generated server certificates, their private keys, and the CA certificate. </li>
                                                    <li value="2">A <code>private</code> folder for the CA private key.</li>
                                                </ol>
                                                <p>This separation reduces the risk of copying the CA private key unintentionally. The tool will not store passphrases anywhere.</p>
                                                <p>The tool also generates the certificate and private key of the certification authority; all other actions are rejected. For this, it needs:<br />* The distinguished name of the subject of the CA certificate either interactively or behind the command line parameter <code>-dn</code>. The distinguished name must obey the AVA format for distinguished names according to <a href="http://www.ietf.org/rfc/rfc4514.txt">http://www.ietf.org/rfc/rfc4514.txt</a>. <br />* The passphrase of the CA private key either interactively or behind the command line parameter <code>-capass</code>.<br />* The number of days which the certificate should be valid, starting from the current time; either interactively or behind the command line parameter <code>-days</code>.<br />* Optionally, the port of the node.js server to which the server certificate should be transferred through encrypted HTTP requests (either interactively by entering a positive port number) or behind the command line parameter <code>-port</code>. This only works when the server already has the CA certificate.</p>
                                                <p>When the CA certificate is available, the user can perform the following actions. When the corresponding command line parameter is not given, the action will be asked interactively. Note that the CA passphrase will only be prompted once when you do several actions within one session of the program.</p>
                                                <h2 id="Createanewservercertificatecommandlineparametercreate" data-magellan-target="Createanewservercertificatecommandlineparametercreate">Create a new server certificate (command line parameter <code>-create</code>)</h2>
                                                <p>This action requires the following:<br />* The computer name of the server interactively or as a last command line parameter.<br />* The passphrase of the private key for the server certificate interactively or behind a <code>-pass</code> parameter.<br />* The passphrase of the private key for the CA certificate interactively or behind a <code>-capass</code> parameter.<br />* The server name as it should be used from other servers in TCP connections either interactively or as a common name of a distinguished name behind the <code>-dn</code> parameter, or as a value behind the <code>-cn</code> parameter. The default value is the computer name. The other parts of the distinguished name will be used from the CA certificate unless the <code>-dn</code> parameter is given.<br />* The number of days which the certificate should be valid, starting from the current time; either interactively or behind the command line parameter <code>-days</code>, default being the validity of the CA certificate.</p>
                                                <p>Remark: Unless the <code>-notransfer</code> switch is set, you are prompted for the port of a node.js server. Only if you enter a valid positive port number, the data is transferred to that server using encrypted HTTP requests.</p>
                                                <h2 id="Renewthevalidityofthecertificatecommandlineparameterrenewcert" data-magellan-target="Renewthevalidityofthecertificatecommandlineparameterrenewcert">Renew the validity of the certificate (command line parameter <code>-renew-cert</code>)</h2>
                                                <p>This action generates a new certificate with the same subject, but different validity.<br />This requires the following:<br />* The computer name of the server interactively or as a last command line parameter.<br />* The passphrase of the private key for the CA certificate interactively or behind a <code>-capass</code> parameter.<br />* The number of validity days of the certificate, starting from the current time either interactively or behind the command line parameter <code>-days</code>, default being the current validity of the certificate.</p>
                                                <p>Remark: Unless the <code>-notransfer</code> switch is set, you are prompted for the port of the node.js server. Only if you enter a valid positive port number, the data is transferred to that server using encrypted HTTP requests.</p>
                                                <h2 id="Renewthevalidityofallcertificatescommandlineparameterrenewallcerts" data-magellan-target="Renewthevalidityofallcertificatescommandlineparameterrenewallcerts">Renew the validity of all certificates (command line parameter <code>-renew-all-certs</code>)</h2>
                                                <p>This action changes, in a single action, the validity of the CA certificate and all server certificates to the given date. This requires the following:<br />* The passphrase of the private key for the CA certificate interactively or behind a <code>-capass</code> parameter.<br />* The number of validity days of the certificate, starting from the current time either interactively or behind the command line parameter <code>-days</code>, default being the current validity of the certificate.</p>
                                                <p>Remark: Unless the <code>-notransfer</code> switch is set, you are prompted for all ports of node.js servers one after another. Only if you enter a valid positive port number, the data is transferred to that server including the new CA certificate. This does not work in batch mode.</p>
                                                <h2 id="Generateanewprivatekeycommandlineparameterrenewkey" data-magellan-target="Generateanewprivatekeycommandlineparameterrenewkey">Generate a new private key (command line parameter <code>-renew-key</code>)</h2>
                                                <p>This action generates a new pair of public and private keys as well as a new certificate with the same subject and validity, but containing the new public key. When this is applied to the CA certificate, it automatically signs all server certificates with the new key. This requires the following:<br />* The computer name of the server or an empty name for the CA certificate interactively or as a last command line parameter.<br />* The passphrase of the new private key interactively or behind a <code>-pass</code> parameter; when the CA certificate key is changed, the <code>-capass</code> parameter should be used instead.<br />* For server certificates only, the passphrase of the existing private key for the CA certificate interactively or behind a <code>-capass</code> parameter.</p>
                                                <p>Remark: Unless the <code>-notransfer</code> switch is set, you are prompted for the port of a node.js server. Only if you enter a valid positive port number, the data is transferred to that server using encrypted HTTP requests. When you change the key of the CA certificate, you are prompted for all ports of node.js servers one after another. Only if you enter a valid positive port number, the data is transferred to that server including the new CA certificate. This does not work in batch mode.</p>
                                                <h2 id="Changethesubjectofthecertificatecommandlineparameterchangename" data-magellan-target="Changethesubjectofthecertificatecommandlineparameterchangename">Change the subject of the certificate (command line parameter <code>-change-name</code>)</h2>
                                                <p>This action changes the subject of the certificate without changing the validity. If applied to the CA certificate, it changes the issuer of all CA certificates and signs them again. When the subject of the certificate is identical to the issuer (except for the common name), the subject (except for the common name) is also changed. </p>
                                                <p>Example: The CA certificate has a distinguished name <code>C=de,ST=bw,L=vs,O=xx,OU=mm,CN=ca</code> which is changed to <code>C=uu,ST=vv,L=ww,O=xx,OU=yy,CN=zz</code>. Then the subject <code>C=de,ST=bw,L=vs,O=xx,OU=mm,CN=server1</code> is changed to <code>C=uu,ST=vv,L=ww,O=xx,OU=yy,CN=server1</code>. However, the subject <code>C=ab,ST=cd,L=ef,O=gh,OU=ij,CN=kl</code> remains unchanged.</p>
                                                <p>This requires the following:<br />* The computer name of the server or an empty name for the CA certificate interactively or as a last command line parameter.<br />* The passphrase of the private key for the CA certificate interactively or behind a <code>-capass</code> parameter.<br />* The number of validity days of the certificate, starting from the current time; either interactively or behind the command line parameter <code>-days</code>, default being the current validity of the certificate.<br />* The new distinguished name of the subject. You can enter this interactively (with the old name being the default), use the parameter <code>-cn</code> to set a new common name, or <code>-dn</code> to set a new distinguished name (the distinguished name must obey the AVA format for distinguished names according to <a href="http://www.ietf.org/rfc/rfc4514.txt">http://www.ietf.org/rfc/rfc4514.txt</a>). For server certificates, you are only prompted for the new common name (name of the server as used in TCP connections), and for the CA certificate you are prompted for all parts of the common name.</p>
                                                <p>Remark: Unless the <code>-notransfer</code> switch is set, you are prompted for the port of a node.js server. Only if you enter a valid positive port number, the data is transferred to that server. When you change the key of the CA certificate, you are prompted for all ports of node.js servers one after each other. Only if you enter a valid positive port number, the data is transferred to that server including the new CA certificate. This does not work in batch mode.</p>
                                                <h2 id="Showcontentsofthecertificatecommandlineparametershow" data-magellan-target="Showcontentsofthecertificatecommandlineparametershow">Show contents of the certificate (command line parameter <code>-show</code>)</h2>
                                                <p>This action shows the subject and issuer distinguished names and the start and end date of the validity for the certificate. This requires the following:<br />* The computer name of the server or an empty name for the CA certificate interactively or as a last command line parameter.</p>
                                                <h2 id="Showcontentsofallcertificatescommandlineparametershowall" data-magellan-target="Showcontentsofallcertificatescommandlineparametershowall">Show contents of all certificates (command line parameter <code>-show-all</code>)</h2>
                                                <p>This action will show the subject and issuer distinguished names and the start and end date of the validity for all certificates. This does not require any further data.</p>
                                                <h2 id="Deletedataforaservercommandlineparameterdelete" data-magellan-target="Deletedataforaservercommandlineparameterdelete">Delete data for a server (command line parameter <code>-delete</code>)</h2>
                                                <p>This action deletes the certificate, public key file (for the Sage X3 server), and the private key file from the output directory. The CA certificate cannot be deleted in this manner. This requires the following:<br />* The computer name of the server interactively or as a last command line parameter.</p>
                                                <h2 id="Transfercertificateandprivatekeycommandlineparametertransfer" data-magellan-target="Transfercertificateandprivatekeycommandlineparametertransfer">Transfer certificate and private key (command line parameter <code>-transfer</code>)</h2>
                                                <p>This action is only shown when the <code>-notransfer</code> switch is not set. It transfers the certificate, private key, and passphrase of a node.js server to another node.js server (provided these files are in the <code>output</code> folder). This requires the following:<br />* The computer name of the server or an empty name for the CA certificate interactively or as a last command line parameter.<br />* The passphrase of the private key for the server certificate interactively or behind a <code>-pass</code> parameter.<br />* The passphrase of the private key for the CA certificate interactively or behind a <code>-capass</code> parameter.<br />* The port of the node.js server interactively or behind a <code>-port</code> parameter.</p>
                                                <h2 id="Setthepassphrasefortheprivatekeyonanodejsserver" data-magellan-target="Setthepassphrasefortheprivatekeyonanodejsserver">Set the passphrase for the private key on a node.js server</h2>
                                                <p>This is only necessary when you do not use the certificate generation tool to transfer the passphrase. This is done by using the <code>passphrase.cmd</code> batch file or <code>passphrase.sh</code> shell script (as described above in "Distribution of certificates to node.js servers"). This encrypts the password of the generated private key on the server and is dependent on the user (for example, on MS Windows using CryptProtectData). When it is invoked without further parameters, it checks the validity of the certificates. Otherwise, it sets and encrypts the passphrase.</p>
                                                <h2 id="Detailsabouttheencryptedtransferofcertificatedata" data-magellan-target="Detailsabouttheencryptedtransferofcertificatedata">Details about the encrypted transfer of certificate data</h2>
                                                <p>The certificate generation tool makes two requests to the node.js server:<br />* The first one is for a Diffie-Hellman key exchange.<br />* The second one transfers the data that has been encrypted with the common secret Diffie-Hellman key and signed with the private CA key. </p>
                                                <p>The certificate generation tool will authenticate using the private CA key, while the node.js server authentication task is performed according to the public CA key. This key that should be reachable via the server name that figures in the server certificate as <strong><em>subject common name</em></strong>. </p>
                                                <h2 id="Structureofthecertificatefolder" data-magellan-target="Structureofthecertificatefolder">Structure of the certificate folder</h2>
                                                <p>The setup generates a special folder for certificates and keys, and writes its path to the 'nodelocal.js' file.</p>
                                                <p>In the certificate folder, there is a subfolder with the computer name in lower case (both folders are generated by the setup if they do not already exist); containing the following files (assuming the server name is <code>foo</code> in lower case):<br />- <code>ca.cacrt</code>: Certificate of the generated certification authority (maybe other certificates of certification authorities with extension .cacrt).<br />- <code>foo.crt</code>: Certificate of the server (maybe other certificates with extension .crt).<br />- <code>foo.key</code>: Private key file of the server (maybe other private key files with extension .key).<br />- <code>foo.pwd:</code> File with encrypted pass phrases for all private keys of that server.</p>
                                                <p><strong>Remark:</strong> Within the certificate directory, the subfolder is intended to avoid problems when the administrator chooses to install all the above mentioned files on a network drive, and therefore certificates of different servers have to be stored within the same folder. Furthermore, this situation is of no risks as access rights to the subfolder and its files are restricted to the operating system user account under which the node.js processes will run.</p>
                                                <h2 id="Certificateentity" data-magellan-target="Certificateentity">Certificate entity</h2>
                                                <p>There is an entity for <a href="administration-reference_certificates.html">certificates</a> and an <a href="administration-reference_ca-certificates.html">entity for CA certificates</a> which contain the metadata for the certificates and private keys:<br />- <strong>A logical name</strong> consisting of lower case letters, underscore, and dot. Acting as a key value which will be the computer name for the administrator generated server certificates, and private keys and <code>ca</code> for the administrator generated certification authority.<br />- <strong>A marker</strong> if the certificate is administrator generated, has been manually installed at setup time, and therefore cannot be changed using the GUI.<br />- <strong>A checksum of the certificate</strong> which is not for the administrator generated certificates to ensure integrity (hidden field).<br />- <strong>Validity of the certificates.</strong><br />- <strong>Distinguished names of issuer and subject.</strong></p>
                                                <p>Both entities contain an upload field for the certificate, yet only the checksum of the certificate will be stored in the database.</p>
                                                <p>The certificate entity also contains:<br />* A flag if a private key has been uploaded for that certificate. <br />* An upload field for the private key.<br />* An input field for the pass phrase that will <em>not</em> be stored in the database. </p>
                                                <p>Some certificates are only useful for one server (for example, SSL server certificate). The corresponding instance of the host entity is placed as a related instance to the certificate instance. When there is no instance, the certificate is stored on all hosts and is transferred at startup to servers where the certificate is missing (for example, servers added to the cluster).</p>
                                                <p>The fields for the certificate, the private key, and the passphrase are input fields only. However, you can update just the certificate and leave the private key unchanged. The following consistency checks will be done:</p>
                                                <ul>
                                                    <li>Certificate and private key have correct PEM format.</li>
                                                    <li>Passphrase fits the private key.</li>
                                                    <li>Certificate fits the private key. The check is done on a server which has all the data, not only the data that have been entered on the screen. Therefore, the check also works when the user uploads only a certificate since the private key has already been uploaded.</li>
                                                </ul>
                                                <p>The instances of the certificate entity and the CA certificate entity, which correspond to the administrator generated certificates, are marked as read-only.</p>
                                                <br />
                                            </div>
                                            <div data-mc-conditions="Other.Production only">
                                                <div id="feedback-survey">
                                                    <div class="feedback-question">
                                                        <h4>Did you find this helpful?</h4>
                                                        <p>
                                                            <button class="feedback-button feedback-yes" title="Yes, this article was helpful." alt="Yes, this article was helpful.">Yes</button>&#160;<button class="feedback-button feedback-no" title="No, this article wasn't helpful." alt="No, this article wasn't helpful.">No</button></p>
                                                    </div>
                                                    <div class="feedback-reason no">
                                                        <hr />
                                                        <div class="highlightBox">
                                                            <h4>Sorry about that</h4>
                                                            <p>Why wasn't this helpful? (check all that apply)</p>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option1" value="Couldn't find what I was looking for" data-analytics-label="Could not find" />
                                                                <label for="option1">Couldn't find what I was looking for</label>
                                                            </div>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option2" value="Instructions confusing or unclear" data-analytics-label="Confusing or unclear" />
                                                                <label for="option2">Instructions confusing or unclear</label>
                                                            </div>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option3" value="Instructions didn't work" data-analytics-label="Did not work" />
                                                                <label for="option3">Instructions didn't work</label>
                                                            </div>
                                                            <div class="feedback-reason no-thanks">
                                                                <p><b>Thanks for your feedback.</b>
                                                                </p>
                                                                <h4>Want to tell us more?</h4>
                                                                <p>Send an email to our authors to leave your feedback.</p>
                                                                <!--email_off-->
                                                                <p><a href="mailto:Sage200TechnicalAuthors@sage.com?subject=Sage 200 feedback" id="feedbackEmailLink" title="Tell us if there's a problem with the information on this page." alt="Tell us if there's a problem with the information on this page." class="sageButton">Email our authors</a>
                                                                </p>
                                                                <!--/email_off-->
                                                                <p>Sorry, but we can't provide technical support from this email address. If you need assistance, then please contact our support team directly.</p>
                                                            </div>
                                                        </div>
                                                        <div id="get-in-touch" class="highlightBox colour-dark-1">
                                                            <h4>Need support?</h4>
                                                            <p>You can contact our support team on <b>0845 111 5555</b>, 9am-5pm Monday-Friday.</p>
                                                        </div>
                                                    </div>
                                                    <div class="feedback-reason yes-thanks">
                                                        <hr />
                                                        <h4>Great!</h4>
                                                        <p>Thanks for taking the time to give us some feedback.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sage-layout-topic-panel">
                                            <div class="menu-topic-container" id="menu-on-page">
                                                <ul data-magellan="" data-animation-duration="250" data-active-class="selected" data-scroll-container=".body-container" data-scroll-container-on="only screen and (min-width: 1280px)" class="nocontent menu _Skins_Sage_Menu_Topic_TopNav mc-component">
                                                    <li><a href="#Certificateinstallation70"> Certificate installation_7.0
</a>
                                                    </li>
                                                    <li><a href="#Introductionaboutcertificates">Introduction about certificates</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Whatisapublickeyaprivatekeyacertificateandapassphrase">What is a public key, a private key, a certificate, and a passphrase?</a>
                                                        </li>
                                                        <li><a href="#Howdocertificatesoperate">How do certificates operate?</a>
                                                        </li>
                                                        <li><a href="#Mastercertificate">Master certificate</a>
                                                        </li>
                                                        <li><a href="#nodejscertificate">node.js certificate</a>
                                                        </li>
                                                    </ul>
                                                    <li><a href="#Simplifiedcertificateprocedure">Simplified certificate procedure</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Whyisacompleteautomationimpossible">Why is a complete automation impossible?</a>
                                                        </li>
                                                        <li><a href="#Usingthesimplifiedprocedure">Using the simplified procedure</a>
                                                        </li>
                                                        <li><a href="#Thesimplifiedgenerationkeyprocedure">The simplified generation key procedure</a>
                                                        </li>
                                                        <li><a href="#Finalstep">Final step</a>
                                                        </li>
                                                    </ul>
                                                    <li><a href="#Completegenerationprocedure">Complete generation procedure</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Generatingcertificates">Generating certificates</a>
                                                        </li>
                                                        <li><a href="#Distributionofcertificatestonodejsservers">Distribution of certificates to node.js servers</a>
                                                        </li>
                                                        <li><a href="#DistributionofpublickeystotheSageX3server">Distribution of public keys to the Sage X3 server</a>
                                                        </li>
                                                    </ul>
                                                    <li><a href="#AppendixDetailedgenerationprocedure">Appendix: Detailed generation procedure</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Generatingcertificates1">Generating certificates</a>
                                                        </li>
                                                        <li><a href="#FirstInvocation">First Invocation</a>
                                                        </li>
                                                        <li><a href="#Createanewservercertificatecommandlineparametercreate">Create a new server certificate (command line parameter -create)</a>
                                                        </li>
                                                        <li><a href="#Renewthevalidityofthecertificatecommandlineparameterrenewcert">Renew the validity of the certificate (command line parameter -renew-cert)</a>
                                                        </li>
                                                        <li><a href="#Renewthevalidityofallcertificatescommandlineparameterrenewallcerts">Renew the validity of all certificates (command line parameter -renew-all-certs)</a>
                                                        </li>
                                                        <li><a href="#Generateanewprivatekeycommandlineparameterrenewkey">Generate a new private key (command line parameter -renew-key)</a>
                                                        </li>
                                                        <li><a href="#Changethesubjectofthecertificatecommandlineparameterchangename">Change the subject of the certificate (command line parameter -change-name)</a>
                                                        </li>
                                                        <li><a href="#Showcontentsofthecertificatecommandlineparametershow">Show contents of the certificate (command line parameter -show)</a>
                                                        </li>
                                                        <li><a href="#Showcontentsofallcertificatescommandlineparametershowall">Show contents of all certificates (command line parameter -show-all)</a>
                                                        </li>
                                                        <li><a href="#Deletedataforaservercommandlineparameterdelete">Delete data for a server (command line parameter -delete)</a>
                                                        </li>
                                                        <li><a href="#Transfercertificateandprivatekeycommandlineparametertransfer">Transfer certificate and private key (command line parameter -transfer)</a>
                                                        </li>
                                                        <li><a href="#Setthepassphrasefortheprivatekeyonanodejsserver">Set the passphrase for the private key on a node.js server</a>
                                                        </li>
                                                        <li><a href="#Detailsabouttheencryptedtransferofcertificatedata">Details about the encrypted transfer of certificate data</a>
                                                        </li>
                                                        <li><a href="#Structureofthecertificatefolder">Structure of the certificate folder</a>
                                                        </li>
                                                        <li><a href="#Certificateentity">Certificate entity</a>
                                                        </li>
                                                    </ul>
                                                </ul>
                                            </div>
                                        </div>
                                    </section>
                                    <button class="go-to-top">
                                        <!-- icon and label are inserted -->
                                    </button>
                                    <section class="sage-footer colour-dark-1" id="footer" role="contentinfo">
                                        <div class="row">
                                            <div class="small-6 medium-3 columns">
                                                <h5>Site links</h5>
                                                <p><a href="../Sitemap.htm" class="MCXref xref">Sitemap</a>
                                                </p>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Sage links</h5>
                                                <p><a href="https://my.sage.co.uk/public/help.aspx" target="_blank" class="external">Sage Support Hub</a>
                                                </p>
                                                <p><a href="https://communities.sage.co.uk/product_support_community/" class="external" target="_blank" title="Your place to get product support from other customers and Sage experts" alt="Your place to get product support from other customers and Sage experts">Product support community</a>
                                                </p>
                                                <p><a href="https://www.sage.com/en-gb/gdpr/" class="external" target="_blank">General Data Protection Regulation</a>
                                                </p>
                                                <p><a href="https://www.sage.com/en-gb/legal/" class="external" target="_blank">Legal information</a>
                                                </p>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Page info</h5>
                                                <p>Page updated: <span class="mc-variable Dates.DateFileSaved variable">26 fevereiro 2024</span></p>
                                                <!-- script moves last published date to here -->
                                                <div id="last-published-footer">
                                                </div>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Sage media</h5>
                                                <p><a href="https://www.facebook.com/sageuk" target="_blank" alt="Find us on Facebook" title="Find us on Facebook"><i class="fa fa-lg fa-facebook" aria-hidden="true"></i></a>&#160;
						<a href="https://www.linkedin.com/company/sage-software" target="_blank" alt="Find us on LinkedIn" title="Find us on LinkedIn"><i class="fa fa-lg fa-linkedin" aria-hidden="true"></i></a>&#160;
						<a href="https://twitter.com/sageuk/" target="_blank" alt="Find us on Twitter" title="Find us on Twitter"><i class="fa fa-lg fa-twitter" aria-hidden="true"></i></a>&#160;
						<a href="https://www.youtube.com/user/SageUKOfficial" target="_blank" alt="Find us on YouTube" title="Find us on YouTube"><i class="fa fa-lg fa-youtube" aria-hidden="true"></i></a></p>
                                            </div>
                                        </div>
                                    </section>
                                    <!-- Skin type scripts -->
                                    <script type="text/javascript" src="../Resources/Scripts/SideNav-template.js" data-mc-conditions="Other.HTML5-SideNav">
                                    </script>
                                    <!-- Google Analytics -->
                                    <div data-mc-conditions="Other.Production only">
                                        <!-- Google analytics script -->
                                        <!-- Copy and paste full HTML of tracking code here for Global site tag (gtag.js) -->
                                        <!-- Remember to edit 'async' parameter to read async="" -->
                                        <!-- Analytics for events -->
                                        <script type="text/javascript" src="../Resources/Scripts/google-analytics-events.js">
                                        </script>
                                    </div>
                                    <!-- cookies -->
                                    <script src="../Resources/Scripts/jquery.cookiesdirective.sage.js">
                                    </script>
                                    <script src="../Resources/Scripts/jquery.cookiesdirective.sage.config.js">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>