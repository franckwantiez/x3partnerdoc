<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="es-es" xml:lang="es-es" class="_Skins_Sage_Skin_SideNav" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <meta charset="utf-8" />
        <meta name="description" content="Calling classic code from service code and vice-versa" />
        <meta name="module" content="Platform" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" /><title> Calling classic code from service code and vice-versa
</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/Sage.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/Stylesheets/font-awesome.css" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: #000000 url('../../Skins/Default/Stylesheets/Images/60x60_globe_white-on-transparent_icon.png') no-repeat center center;
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../Resources/TableStyles/NormalRows.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <script type="text/javascript">/*<![CDATA[*/


function onload(){
	window.focus();
	window[window.history.pushState ? "onpopstate" : "onhashchange"] = function(event){ windows.focus(); };
}


/*]]>*/</script>
        <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Atrás" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Saltar a contenido principal</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Cuenta</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Configuración</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Cerrar sesión</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Mostrar panel de navegación" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Home.htm" alt="Logotipo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Cuenta</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Configuración</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Cerrar sesión</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Campo de búsqueda" placeholder="Buscar" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filtro:</span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Filtro de búsqueda" title="Todos los archivos" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">Todos los archivos</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Buscar" role="button" tabindex="0"><span class="invisible-label">Enviar búsqueda</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <script type="text/javascript">/*<![CDATA[*/$(document).ready(function(){
			$("#selectlang").appendTo("div.central-account-wrapper");
		});/*]]>*/</script>
                                    <div id="selectlang" class="headerlang">
                                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_Language_toggle mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                            <div class="button-group-container-left">
                                                <button class="button needs-pie select-language-button" title="Cambiar idioma">
                                                    <div>
                                                        <div role="img" class="button-icon-wrapper" aria-label="Cambiar idioma">
                                                            <div class="button-icon"> </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="sage-header-title">
                                        <img id="sage-header-logo" src="../Resources/Images/Sage_logo_green.svg" alt="Sage" /><span id="sage-header-product-name"><span id="sage-header-product"><span class="mc-variable Sage-Product.ProductName variable">X3 Warehousing</span></span></span>
                                    </div>
                                    <section class="sage-topic-body sage-layout-two-columns">
                                        <div class="sage-layout-topic-main">
                                            <div role="main" id="mc-main-content">
                                                <h1 id="Callingclassiccodefromservicecodeandviceversa" data-magellan-target="Callingclassiccodefromservicecodeandviceversa"> Calling classic code from service code and vice-versa
</h1>
                                                <p><strong>During the cohabitation period between classic code and code written with classes (what we call service code), it can be interesting to call classic code from service code and vice-versa. Doing this requires a special way to call the code, because the environment running service and classic code are not the same and will see their technical implementation change and diverge more and more. In a near future, a new generation engine will execute the X3 service code. Its principles are the following:</strong>
                                                </p>
                                                <ul>
                                                    <li><strong>the new engine will be a dedicated service running on node.js.</strong>
                                                    </li>
                                                    <li><strong>it will be able to run the service. All the instructions usable in service code are supported ( <a href="4gl_file.html">File</a>, <a href="4gl_for.html">For</a>, <a href="4gl_call.html">Call</a>, <a href="4gl_fmet.html">fmet</a>... for instance).</strong>
                                                    </li>
                                                    <li><strong>it will not run the classic code instructions that are deprecated in service development ( such as <a href="4gl_Affzo.html">Affzo</a>, <a href="4gl_Infbox.html">Infbox</a> for instance).</strong>
                                                    </li>
                                                    <li><strong>The execution of the native code will automatically be done on the new engine when it will be available without any modification in the code. But the legacy code will continue to be executed on the adonix run-time engine</strong>
                                                    </li>
                                                </ul>
                                                <p><strong>This is why a technique based on dedicated wrappers has been developed to handle this cross-technology calls. This technique can already be used with the current engine and will remain with the new engine, as long as the classic code will be supported.</strong>
                                                </p>
                                                <p><strong>Take care that there is an overhead cost to use this call. You should avoid it to call a function that runs only a dozen of instructions. This has been more done to call large functions of classic code that have not been reimplemented in service code, or to handle new service consistent functions from classic code.</strong>
                                                </p>
                                                <p><strong>Note that this description is independent from availability of the new engine. Whenever the service code is executed by the new engine or by an adonix process, the procedure to call the code from a layer to the other will remain the same, because we need to identify the connection points between classic code and service code.</strong>
                                                </p>
                                                <p>Two main scenarios will be covered:</p>
                                                <ul>
                                                    <li><strong>Classic code calling remote service code</strong>: the ability for Classic code run by a Classic engine to call service code run by the new engine. This is an <em>out-of-process</em> scenario because the calling code and the called code are in different processes. The parameters and the results are <em>marshalled</em> (serialized and sent over a communication channel) across process boundaries.</li>
                                                    <li><strong>Service code calling remote Classic code</strong>: similar to the previous case, just in the opposite direction.</li>
                                                </ul>
                                                <p>Additionally, we will describe the limitations when using classic code and service code.</p>
                                                <h2 id="Note" data-magellan-target="Note">Note:</h2>
                                                <p>It is technically possible to a library that would be able to run both in classic and service mode, but this <strong>not recommended</strong>.</p>
                                                <h1 id="Callingservicecodefromclassiccode" data-magellan-target="Callingservicecodefromclassiccode">Calling service code from classic code</h1>
                                                <p>Writing classic code can use tables and masks as well as the instructions that are not deprecated in web mode. It is also possible to declare structures similar to classes by using the following instructions:</p>
                                                <ul>
                                                    <li><code>Local <a href="4gl_instance.html">Instance</a></code> declares a class (but only a class and not a representation). The rules, the methods, and the operations are not available in classic code (the structure is really seen as a storage structure).</li>
                                                    <li><code><a href="4gl_newinstance.html">NewInstance</a></code> instanciates a class.
</li>
                                                    <li><code><a href="4gl_freegroup.html">FreeGroup</a></code> releases a group.
</li>
                                                </ul>
                                                <p>These classes will act as pure data containers, without any behavior associated to the data. More specifically:</p>
                                                <ul>
                                                    <li>Properties of all data types <strong>will be supported</strong>.</li>
                                                    <li>Collections <strong>will be supported</strong>.</li>
                                                    <li>Accessors, methods and events <strong>will not be supported</strong>.</li>
                                                </ul>
                                                <p>It is nevertheless possible to use the following methods on a class in classic code:</p>
                                                <ul>
                                                    <li><code><a href="developer-guide_classes-standard-methods.html#addline">ADDLINE</a></code> adds a line in a collection of a class.
</li>
                                                    <li><code><a href="developer-guide_classes-standard-methods.html#addelline">ADELLINE</a></code> deletes a line in a collection of a class.
</li>
                                                    <li>The <a href="developer-guide_context.html">context</a> and the corresponding methods are available (for instance <code>GACTX.APARAM.AGETVALPAR</code>)</li>
                                                </ul>
                                                <p>This allows notably to prepare instances that can directly be transferred with the gateway structure.</p>
                                                <p>Classic code <em>cannot</em> use representations.</p>
                                                <p>Calling service code from classic code uses the following elements:</p>
                                                <h2 id="Thegatewaystructure" data-magellan-target="Thegatewaystructure">The gateway structure</h2>
This structure is the communication structure used to call service code calls from classic page code. The declaration of this structure is done as a normal instance. For example, if we want to declare a gateway structure called MYGATEWAY, you will write the following code:<pre xml:space="preserve"><code># This is classic code
Local Instance MYGATEWAY Using C_AGATEWAYADX
  MYGATEWAY= NewInstance C_AGATEWAYADX Allocgroup null</code></pre><h2 id="Writingvaluesintothegatewayinstance" data-magellan-target="Writingvaluesintothegatewayinstance">Writing values into the gateway instance</h2><p>Once this structure is instantiated, you can fill this structure with any type of value including single values, arrays, and even instances. This is done by using several methods:</p><table style="mc-table-style: url('../Resources/TableStyles/NormalRows.css');" class="TableStyle-NormalRows" cellspacing="0"><tr class="TableStyle-NormalRows-Body-Body2"><th class="TableStyle-NormalRows-BodyE-Column1-Body2">Method name</th><th class="TableStyle-NormalRows-BodyD-Column1-Body2">Type of parameter</th></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">ASETVALTYNIINT</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_tinyint.html">Tinyint</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">ASETVALSHORTINT</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_shortint.html">Shortint</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">ASETVALINTEGER</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_integer.html">Integer</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">ASETVALDEC</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_decimal.html">Decimal</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">ASETVALDOUBLE</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_double.html">Double</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">ASETVALCHAR</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_char.html">Char</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">ASETVALDATE</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_date.html">Date</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">ASETVALBLOB</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_blbfile.html">Blbfile</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">ASETVALCLOB</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_clbfile.html">Clbfile</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">ASETVALUUID</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_uuident.html">Uuident</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">ASETVALDATETIME</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_datetime.html">Datetime</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">ASETVALINST</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_instance.html">Instance</a></td></tr></table><p>These methods has two arguments:<br />* the first is a string that contains a name that identifies the parameter.<br />* the second is the variable containing the parameter.</p><p>It returns <code>[V]CST_AOK</code> or <code>[V]CST_AERROR</code>.</p><p>Any parameter can be a single value or an array of values (all values will be sent).</p><h2 id="Callingtheservicecode" data-magellan-target="Callingtheservicecode">Calling the service code</h2><p>This is done by using the ARPC method with two arguments: a script name and a function name.</p><h2 id="Retrievingthevalues" data-magellan-target="Retrievingthevalues">Retrieving the values</h2><p>After the call, you can read the result from the structure with he same types of values including single values, arrays, and even instances. This is done by using several methods:</p><table style="mc-table-style: url('../Resources/TableStyles/NormalRows.css');" class="TableStyle-NormalRows" cellspacing="0"><tr class="TableStyle-NormalRows-Body-Body2"><th class="TableStyle-NormalRows-BodyE-Column1-Body2">Method name</th><th class="TableStyle-NormalRows-BodyD-Column1-Body2">Type of parameter</th></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">AGETVALTYNIINT</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_tinyint.html">Tinyint</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">AGETVALSHORTINT</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_shortint.html">Shortint</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">AGETVALINTEGER</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_integer.html">Integer</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">AGETVALDEC</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_decimal.html">Decimal</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">AGETVALDOUBLE</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_double.html">Double</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">AGETVALCHAR</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_char.html">Char</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">AGETVALDATE</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_date.html">Date</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">AGETVALBLOB</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_blbfile.html">Blbfile</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">AGETVALCLOB</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_clbfile.html">Clbfile</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">AGETVALUUID</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_uuident.html">Uuident</a></td></tr><tr class="TableStyle-NormalRows-Body-Body1"><td class="TableStyle-NormalRows-BodyE-Column1-Body1">AGETVALDATETIME</td><td class="TableStyle-NormalRows-BodyD-Column1-Body1"><a href="4gl_datetime.html">Datetime</a></td></tr><tr class="TableStyle-NormalRows-Body-Body2"><td class="TableStyle-NormalRows-BodyE-Column1-Body2">AGETVALINST</td><td class="TableStyle-NormalRows-BodyD-Column1-Body2"><a href="4gl_instance.html">Instance</a></td></tr></table><h2 id="Comments" data-magellan-target="Comments">Comments</h2><p>The variables sent in the gateway structure can be different at every call (return values can be different than the calling values, for instance).</p><p>An error code is returned if the property name given in AGET* methods cannot be found.</p><h2 id="Exampleofacall" data-magellan-target="Exampleofacall">Example of a call</h2>
For example, we can do something like this:<pre xml:space="preserve"><code># Let's call a pricing classic method based on a list of items, a list of quantities, 
# a customer code, a date, and a currency code
# We consider that the only value that is changed is the PRICES array and the FREIGHT value,
# although all the other elements are used to define the prices
Local Instance PRICING Using C_AGETEWAYADX
Local Integer RETVAL
Local Char ITEMS(20)(1..)
Local Decimal QUANTITIES(1..)
Local Decimal PRICES(1..), FREIGHT
Local Char CUSTOMER(20)
Local Date ORDER_DATE
Local Char CURRENCY(10)
Local Instance DELIVERY_ADDRESS Using C_ADDRESS
Local Decimal FREIGHT
  Gosub FILL_VALUES : # This call fills the variables defined before
  PRICING= NewInstance C_AGETEWAYADX Allocgroup null
# Let's fill the gateway structure and handle the errors
# We don't send the FREIGHT value
  RETVAL=[V]CST_AERROR
  If fmet PRICING.ASETVALCHAR("ITM",ITEMS)=[V]CST_AOK
    If fmet PRICING.ASETVALDEC("QTY",QUANTITIES)=[V]CST_AOK
      If fmet PRICING.ASETVALCHAR("PRICE",PRICES)=[V]CST_AOK
        If fmet PRICING.ASETVALCHAR("CUSTOMER",CUSTOMER)=[V]CST_AOK
          If fmet PRICING.ASETVALDATE("ODAT",ORDER_DATE)=[V]CST_AOK
            If fmet PRICING.ASETVALCHAR("CUR",CURRENCY)=[V]CST_AOK
            RETVAL=fmet PRICING.ASETVALINST("ADDRESS",DELIVERY_ADDRESS)
            Endif
          Endif
        Endif
      Endif
    Endif
  Endif
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
# Let's call the method
  RETVAL = fmet PRICING.ARPC("GETPRICES","PRICE_LIB")  
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
# Now we can get the result
  RETVAL=[V]CST_AERROR
  If fmet PRICING.AGETVALCHAR("PRICE",PRICES)=[V]CST_AOK
    RETVAL = fmet PRICING.AGETVALDEC("FREIGHT",FREIGHT)
  Endif
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif</code></pre><h2 id="Servicecodecalled" data-magellan-target="Servicecodecalled">Service code called</h2><p>The ARPC method executed on a given function from a given script calls a label $GATEWAY that must be present in the script called with the name of the script. Two variables are then available:<br />- <code>AGATEWAY</code> is the name the gateway function that has been used in ARPC method<br />- <code>this</code> is a the gateway structure that supplies the same access methods (AGETVALxxx, ASETVALxxx) to read or update the properties sent by the classic code.</p><p>The list of properties read and written, and the order in which they are written can be changed freely. If an attempt to read a property that does not exist or that doesn't have a compatible type is done, the method returns <code>[V]CST_AERROR</code>.</p><h2 id="ExampleofservicecodecorrespondingtothepreviouscodePRICELIBscript" data-magellan-target="ExampleofservicecodecorrespondingtothepreviouscodePRICELIBscript">Example of service code corresponding to the previous code (PRICE_LIB script)</h2><pre xml:space="preserve"><code>
# Main label called by the ARPC method
$GATEWAY
  Case AGATEWAY:
    When "GETPRICE" : Gosub GETPRICE
    # ...
    # Other calls can be implemented in the same script
    # ...
  Endcase
# Let's imagine the V7+ script uses an ORDER class that includes the properties CUSTOMER, ORDER_DATE, CURRENCY,
# a collection of LINES children instances with ITEM, QUANTITIES, and a DELIVERY instance
$GETPRICE
# List of parameters handled in the gateway
Local Char ITEMS(20)(1..)
Local Decimal QUANTITIES(1..)
Local Decimal PRICES(1..)
Local instance MYORDER Using C_ORDER
Local Integer I, LINE_NO, RETVAL
# Let's instantiate the order
  MYORDER=Newinstance C_ORDER Allocgroup null
# Let's read the gateway structure and handle the errors
# FREIGHT has not been sent, PRICES has been sent because some prices might be fixed
  RETVAL=[V]CST_AERROR
    If fmet this.AGETVALDEC("QTY",QUANTITIES)=[V]CST_AOK
      If fmet this.AGETVALCHAR("PRICE",PRICES)=[V]CST_AOK
        If fmet this.AGETVALCHAR("CUSTOMER",MYORDER.CUSTOMER)=[V]CST_AOK
          If fmet this.AGETVALDATE("ODAT",MYORDER.ORDDATE)=[V]CST_AOK
            If fmet this.AGETVALCHAR("CUR",MYORDER.CURRENCY)=[V]CST_AOK
              RETVAL=fmet this.AGETVALINST("ADDRESS",MYORDER.DELIVERY)
            Endif
          Endif
        Endif
      Endif
    Endif
  Endif
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
# Let's fill the line collection
  For I=1 to maxtab(ITEMS)
    LINE_NO=fmet MYORDER.ADDLINE("LINES",[V]CST_ALASTPOS)
    If LINE_NO&lt;&gt;[V]CST_ANOTDEFINED
      MYORDER.LINES(LINE_NO).ITEM=ITEMS(I)
      MYORDER.LINES(LINE_NO).PRICE=PRICES(I)
      MYORDER.LINES(LINE_NO).QTY=QUANTITIES(I)
    Else
      Break
    Endif
  Next I
  If LINE_NO=[V]CST_ANOTDEFINED
  #  ... Handle the error and exit
  Endif
  # Now we can manage the MYORDER instance by using any V7+ code
  # ...
  # Let's fill again the arrays of prices
  # The script didn't change the number of lines, so we do not care about ASTALIN
  I=0
  For LINE_NO=1 to maxtab(MYORDER.LINES)
    I+=1
    PRICES(I)=MYORDER.LINES(LINE_NO).PRICE
  Next I
# Let's write the gateway structure including FREIGHT and handle the errors
  RETVAL=[V]CST_AERROR
  If fmet this.ASETVALCHAR("PRICE",PRICES)=[V]CST_AOK
    RETVAL = fmet this.ASETVALDEC("FREIGHT",MYORDER.FREIGHT)
  Endif
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
Return</code></pre><h1 id="Callingclassiccodefromservicecode" data-magellan-target="Callingclassiccodefromservicecode">Calling classic code from service code</h1><p>The service code execution can only use a subset of the 4GL language. This subset is described precisely in the <a href="4gl_x3script-keywords-glossary.html">following document</a>.</p><p>A quick overview of the restrictions can be given here:<br />* <em>screen-oriented</em> instructions (<code>Affzo</code>, <code>Grizo</code>, ...) are <em>not</em>  supported.<br />* <em>mask</em> variables (<code>[M]</code> class) are <em>not</em> supported.<br />* <em>security sensitive</em> instructions like <code>System</code> are <em>not</em> supported.<br />* Some system functions and variables are <em>not</em> supported.<br />* Inefficient instructions (<code>Read Next</code>, <code>Read Prev</code>) are <em>not</em> supported.<br />* Some esoteric syntax forms will <em>not</em> are supported.<br />* Global variables are <em>not</em> allowed. </p><p>The information which is usually obtained from global variables in Classic code will be read from a context instead. The context can be passed in one of two ways when calling a function or procedure in a common script:</p><ul><li>Explicitly, as a context parameter</li><li>Implicitly, by passing an instance of class. The context will be obtained from the instance as <code>instance.ACONTEXT</code>.</li></ul><p><strong>The service code can call classic code that only runs with no UI interaction, exactly the kind of code you can run in batch mode.</strong></p><p><strong>In this classic code called from a service code, you can of course use masks and tables, but you cannot use instructions such as <code>[Affzo](../4gl/Affzo.md)</code>.</strong></p><h2 id="Thegatewaystructure1" data-magellan-target="Thegatewaystructure1">The gateway structure</h2><p>The same pattern can be used to perform the call. The only difference is technical gateway class used has another name (C_GATEWAYETNA). So we can give the following example:</p><pre xml:space="preserve"><code># Let's call a Syracuse function to create a record in a class ORDER From a mask (called [M:ORD]).
Local Instance ORDER Using C_AGETEWAYETNA
Local Char ITEMS(20)(1..)
Local Decimal QTY(1..)
Local Decimal PRICE(1..)
Local Integer I
For I=1 To [M:ORD]NBLIN : # Bottom-page variable
  ITEMS(I)=[M:ORD]ITEM(I-1)
  QTY(I)=[M:ORD]QTY(I-1)
  PRICE(I)=[M:ORD]PRICE(I-1)
Next I
# Let's fill the gateway structure and handle the errors
# We don't send the FREIGHT value
  RETVAL=[V]CST_AERROR
  If fmet ORDER.ASETVALCHAR("ITM",ITEMS)=[V]CST_AOK
    If fmet ORDER.ASETVALDEC("QTY",QUANTITIES)=[V]CST_AOK
      If fmet ORDER.ASETVALCHAR("PRICE",PRICES)=[V]CST_AOK
        If fmet ORDER.ASETVALCHAR("CUSTOMER",[M:ORD]CUSTOMER)=[V]CST_AOK
          If fmet ORDER.ASETVALDATE("ODAT",[M:ORD]ORDDATE)=[V]CST_AOK
            RETVAL=fmet ORDER.ASETVALCHAR("CUR",[M:ORD]CURRENCY)
          Endif
        Endif
      Endif
    Endif
  Endif
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
# Let's call the method
  RETVAL = fmet ORDER.ARPC("ACREATE","ORDER_LIB")  
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
# Let's check if the order creation was successful
  RETVAL = fmet ORDER.AGETVAL</code></pre><br />The second script would be :<pre xml:space="preserve"><code>
# Main label called by the ARPC method
$GATEWAY
  Case AGATEWAY:
    When "ACREATE" : Gosub ACREATE
    # ...
    # Other calls can be implemented in the same library
    # ...
  Endcase
$ACREATE
# List of parameters handled in the gateway
Local Char ITEMS(20)(1..)
Local Decimal QUANTITIES(1..)
Local Decimal PRICES(1..)
Local instance MYORDER Using C_ORDER
Local Integer I, LINE_NO, RETVAL
# Let's instantiate the order
  MYORDER=Newinstance C_ORDER Allocgroup null
# Let's read the gateway structure and handle the errors
  RETVAL=[V]CST_AERROR
    If fmet this.AGETVALDEC("ITM",ITEMS)=[V]CST_AOK
      If fmet this.AGETVALDEC("QTY",QUANTITIES)=[V]CST_AOK
        If fmet this.AGETVALCHAR("PRICE",PRICES)=[V]CST_AOK
          If fmet this.AGETVALCHAR("CUSTOMER",MYORDER.CUSTOMER)=[V]CST_AOK
            If fmet this.AGETVALDATE("ODAT",MYORDER.ORDDATE)=[V]CST_AOK
              If fmet this.AGETVALCHAR("CUR",MYORDER.CURRENCY)=[V]CST_AOK
                RETVAL=fmet this.AGETVALINST("ADDRESS",MYORDER.DELIVERY)
              Endif
            Endif
          Endif
        Endif
      Endif
    Endif
  Endif
  If RETVAL=[V]CST_AERROR
    # Handle the error and exit
  Endif
# Let's fill the line collection
  For I=1 to maxtab(ITEMS)
    LINE_NO=fmet MYORDER.ADDLINE("LINES",[V]CST_ALASTPOS)
    If LINE_NO&lt;&gt;[V]CST_ANOTDEFINED
      MYORDER.LINES(LINE_NO).ITEM=ITEMS(I)
      MYORDER.LINES(LINE_NO).PRICE=PRICES(I)
      MYORDER.LINES(LINE_NO).QTY=QUANTITIES(I)
    Else
      Break
    Endif
  Next I
  If LINE_NO=[V]CST_ANOTDEFINED
  #  ... Handle the error and exit
  Endif
# Let's use a standard method
  RETVAL=Fmet MYORDER.AINSERT
  I=fmet ORDER.ASETVALSHORTINT("STA",RETVAL)
  If RETVAL&lt;&gt;[V]CST_AOK
    # Handle the error (possibly by adding additional return values in the payload) and exit
  Endif</code></pre><br /></div>
                                            <div data-mc-conditions="Other.Production only">
                                                <div id="feedback-survey">
                                                    <div class="feedback-question">
                                                        <h4>Did you find this helpful?</h4>
                                                        <p>
                                                            <button class="feedback-button feedback-yes" title="Yes, this article was helpful." alt="Yes, this article was helpful.">Yes</button>&#160;<button class="feedback-button feedback-no" title="No, this article wasn't helpful." alt="No, this article wasn't helpful.">No</button></p>
                                                    </div>
                                                    <div class="feedback-reason no">
                                                        <hr />
                                                        <div class="highlightBox">
                                                            <h4>Sorry about that</h4>
                                                            <p>Why wasn't this helpful? (check all that apply)</p>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option1" value="Couldn't find what I was looking for" data-analytics-label="Could not find" />
                                                                <label for="option1">Couldn't find what I was looking for</label>
                                                            </div>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option2" value="Instructions confusing or unclear" data-analytics-label="Confusing or unclear" />
                                                                <label for="option2">Instructions confusing or unclear</label>
                                                            </div>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option3" value="Instructions didn't work" data-analytics-label="Did not work" />
                                                                <label for="option3">Instructions didn't work</label>
                                                            </div>
                                                            <div class="feedback-reason no-thanks">
                                                                <p><b>Thanks for your feedback.</b>
                                                                </p>
                                                                <h4>Want to tell us more?</h4>
                                                                <p>Send an email to our authors to leave your feedback.</p>
                                                                <!--email_off-->
                                                                <p><a href="mailto:Sage200TechnicalAuthors@sage.com?subject=Sage 200 feedback" id="feedbackEmailLink" title="Tell us if there's a problem with the information on this page." alt="Tell us if there's a problem with the information on this page." class="sageButton">Email our authors</a>
                                                                </p>
                                                                <!--/email_off-->
                                                                <p>Sorry, but we can't provide technical support from this email address. If you need assistance, then please contact our support team directly.</p>
                                                            </div>
                                                        </div>
                                                        <div id="get-in-touch" class="highlightBox colour-dark-1">
                                                            <h4>Need support?</h4>
                                                            <p>You can contact our support team on <b>0845 111 5555</b>, 9am-5pm Monday-Friday.</p>
                                                        </div>
                                                    </div>
                                                    <div class="feedback-reason yes-thanks">
                                                        <hr />
                                                        <h4>Great!</h4>
                                                        <p>Thanks for taking the time to give us some feedback.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sage-layout-topic-panel">
                                            <div class="menu-topic-container" id="menu-on-page">
                                                <ul data-magellan="" data-animation-duration="250" data-active-class="selected" data-scroll-container=".body-container" data-scroll-container-on="only screen and (min-width: 1280px)" class="nocontent menu _Skins_Sage_Menu_Topic_TopNav mc-component">
                                                    <li><a href="#Callingclassiccodefromservicecodeandviceversa"> Calling classic code from service code and vice-versa
</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Note">Note:</a>
                                                        </li>
                                                    </ul>
                                                    <li><a href="#Callingservicecodefromclassiccode">Calling service code from classic code</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Thegatewaystructure">The gateway structure</a>
                                                        </li>
                                                        <li><a href="#Writingvaluesintothegatewayinstance">Writing values into the gateway instance</a>
                                                        </li>
                                                        <li><a href="#Callingtheservicecode">Calling the service code</a>
                                                        </li>
                                                        <li><a href="#Retrievingthevalues">Retrieving the values</a>
                                                        </li>
                                                        <li><a href="#Comments">Comments</a>
                                                        </li>
                                                        <li><a href="#Exampleofacall">Example of a call</a>
                                                        </li>
                                                        <li><a href="#Servicecodecalled">Service code called</a>
                                                        </li>
                                                        <li><a href="#ExampleofservicecodecorrespondingtothepreviouscodePRICELIBscript">Example of service code corresponding to the previous code (PRICE_LIB script)</a>
                                                        </li>
                                                    </ul>
                                                    <li><a href="#Callingclassiccodefromservicecode">Calling classic code from service code</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Thegatewaystructure1">The gateway structure</a>
                                                        </li>
                                                    </ul>
                                                </ul>
                                            </div>
                                        </div>
                                    </section>
                                    <button class="go-to-top">
                                        <!-- icon and label are inserted -->
                                    </button>
                                    <section class="sage-footer colour-dark-1" id="footer" role="contentinfo">
                                        <div class="row">
                                            <div class="small-6 medium-3 columns">
                                                <h5>Site links</h5>
                                                <p><a href="../Sitemap.htm" class="MCXref xref">Sitemap</a>
                                                </p>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Sage links</h5>
                                                <p><a href="https://my.sage.co.uk/public/help.aspx" target="_blank" class="external">Sage Support Hub</a>
                                                </p>
                                                <p><a href="https://communities.sage.co.uk/product_support_community/" class="external" target="_blank" title="Your place to get product support from other customers and Sage experts" alt="Your place to get product support from other customers and Sage experts">Product support community</a>
                                                </p>
                                                <p><a href="https://www.sage.com/en-gb/gdpr/" class="external" target="_blank">General Data Protection Regulation</a>
                                                </p>
                                                <p><a href="https://www.sage.com/en-gb/legal/" class="external" target="_blank">Legal information</a>
                                                </p>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Page info</h5>
                                                <p>Page updated: <span class="mc-variable Dates.DateFileSaved variable">26 febrero 2024</span></p>
                                                <!-- script moves last published date to here -->
                                                <div id="last-published-footer">
                                                </div>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Sage media</h5>
                                                <p><a href="https://www.facebook.com/sageuk" target="_blank" alt="Find us on Facebook" title="Find us on Facebook"><i class="fa fa-lg fa-facebook" aria-hidden="true"></i></a>&#160;
						<a href="https://www.linkedin.com/company/sage-software" target="_blank" alt="Find us on LinkedIn" title="Find us on LinkedIn"><i class="fa fa-lg fa-linkedin" aria-hidden="true"></i></a>&#160;
						<a href="https://twitter.com/sageuk/" target="_blank" alt="Find us on Twitter" title="Find us on Twitter"><i class="fa fa-lg fa-twitter" aria-hidden="true"></i></a>&#160;
						<a href="https://www.youtube.com/user/SageUKOfficial" target="_blank" alt="Find us on YouTube" title="Find us on YouTube"><i class="fa fa-lg fa-youtube" aria-hidden="true"></i></a></p>
                                            </div>
                                        </div>
                                    </section>
                                    <!-- Skin type scripts -->
                                    <script type="text/javascript" src="../Resources/Scripts/SideNav-template.js" data-mc-conditions="Other.HTML5-SideNav">
                                    </script>
                                    <!-- Google Analytics -->
                                    <div data-mc-conditions="Other.Production only">
                                        <!-- Google analytics script -->
                                        <!-- Copy and paste full HTML of tracking code here for Global site tag (gtag.js) -->
                                        <!-- Remember to edit 'async' parameter to read async="" -->
                                        <!-- Analytics for events -->
                                        <script type="text/javascript" src="../Resources/Scripts/google-analytics-events.js">
                                        </script>
                                    </div>
                                    <!-- cookies -->
                                    <script src="../Resources/Scripts/jquery.cookiesdirective.sage.js">
                                    </script>
                                    <script src="../Resources/Scripts/jquery.cookiesdirective.sage.config.js">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>