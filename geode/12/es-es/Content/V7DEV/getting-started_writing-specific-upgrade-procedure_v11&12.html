<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="es-es" xml:lang="es-es" class="_Skins_Sage_Skin_SideNav" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <meta charset="utf-8" />
        <meta name="description" content="Writing a specific upgrade procedure" />
        <meta name="module" content="Platform" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" /><title> Writing a specific upgrade procedure
</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/Sage.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/Stylesheets/font-awesome.css" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.select-language-button
{
	-pie-background: #000000 url('../../Skins/Default/Stylesheets/Images/60x60_globe_white-on-transparent_icon.png') no-repeat center center;
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <script type="text/javascript">/*<![CDATA[*/


function onload(){
	window.focus();
	window[window.history.pushState ? "onpopstate" : "onhashchange"] = function(event){ windows.focus(); };
}


/*]]>*/</script>
        <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Atrás" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Saltar a contenido principal</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Cuenta</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Configuración</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Cerrar sesión</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Mostrar panel de navegación" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Home.htm" alt="Logotipo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Cuenta</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Configuración</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Cerrar sesión</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Campo de búsqueda" placeholder="Buscar" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filtro:</span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Filtro de búsqueda" title="Todos los archivos" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">Todos los archivos</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Buscar" role="button" tabindex="0"><span class="invisible-label">Enviar búsqueda</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <script type="text/javascript">/*<![CDATA[*/$(document).ready(function(){
			$("#selectlang").appendTo("div.central-account-wrapper");
		});/*]]>*/</script>
                                    <div id="selectlang" class="headerlang">
                                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_Language_toggle mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                            <div class="button-group-container-left">
                                                <button class="button needs-pie select-language-button" title="Cambiar idioma">
                                                    <div>
                                                        <div role="img" class="button-icon-wrapper" aria-label="Cambiar idioma">
                                                            <div class="button-icon"> </div>
                                                        </div>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="sage-header-title">
                                        <img id="sage-header-logo" src="../Resources/Images/Sage_logo_green.svg" alt="Sage" /><span id="sage-header-product-name"><span id="sage-header-product"><span class="mc-variable Sage-Product.ProductName variable">X3 Warehousing</span></span></span>
                                    </div>
                                    <section class="sage-topic-body sage-layout-two-columns">
                                        <div class="sage-layout-topic-main">
                                            <div role="main" id="mc-main-content">
                                                <h1 id="Writingaspecificupgradeprocedure" data-magellan-target="Writingaspecificupgradeprocedure"> Writing a specific upgrade procedure
</h1>
                                                <!-- Public -->
                                                <p>Upgrade from an earlier version is performed using a job monitor that launches upgrade procedures in an automated way. Specific upgrade procedures can be added but you have to:</p>
                                                <ol>
                                                    <li value="1">Generate an upgrade processing.</li>
                                                    <li value="2">Reference this processing as an upgrade procedure in the Supervisor folder using the corresponding function (<b>Usage &gt; Upgrades &gt; Upgrade process</b>). <br />
This should be done before creating any upgrade plan and starting any folder revalidation.</li>
                                                </ol>
                                                <p>This document describes the structure of such an upgrade processing. Refer to processing "UUMGTRTPUR01", if necessary. It is used to carry out the upgrade of the purchase requests.</p>
                                                <p><b>Caution:</b> Its source code is provided as an example. Do not modify it as it might make the upgrade procedure invalid.</p>
                                                <h2 id="Basicprinciples" data-magellan-target="Basicprinciples">Basic principles</h2>
                                                <p>During folder validation:</p>
                                                <ol>
                                                    <li value="1">Each transactions table is renamed. By default, the letter "U" is added before its name.<br />
Activity code "MIG" is assigned to each table to make it possible to identify them when the temporary tables are deleted after the upgrade validation.</li>
                                                    <li value="2">The content of these transactions tables is kept strictly identical to the original transactions tables.</li>
                                                    <li value="3">Their indices are deleted (except for the first index, and possibly an additional one that can speed up the upgrade processing).</li>
                                                    <li value="4">One or more empty transactions tables are created according to the dictionary of the new version (the specific fields or modifications to the standard fields made in the original table are included).<br />
The empty table usually has the same name as the original table, unless the table no longer exists in the new version.</li>
                                                </ol>
                                                <p>The upgrade of specific tables can be managed using the same mechanism. This is described in <a href="../getting-started_writing-specific-upgrade-procedure_v11.html#migtab-entry-point">MIGTAB entry point</a>.</p>
                                                <p>The following subprogram can determine the name of the table after it has been renamed:</p><pre xml:space="preserve">     # FOLDER = code of folder
     # PTABLE = name of the movement table before the upgrade
     # PTABLE = name of the renamed movement table
# If ERR&gt;0: an error has been generated (the processing will be interrupted)
     Call MIGTABNAME(FOLDER,PTABLE, MTABLE, ERR) From TRTMIG</pre>
The basic renaming rule is to add the letter "U" before the name of the table. However, there are exceptions, for example if the name of the table exceeds 12 characters. Entry point "TABNAME" in processing "TRTMIG" is used to set entry point "MTABLE" by defining "PTABLE" with a rule that can be different.
Each unitary procedure is defined using a program that upgrades one or several tables in the base. This processing must be called "UUMGSPExxxnn", with "xxx" being the root identifying the table to upgrade, and "nn" being two numbers (to enable the use of several processing routines). It functions as follows:
<ul><li>The original tables are read but not updated (their names are found using the subprogram above).</li><li>The processing writes the modified, completed or transcoded data in the final tables.</li><li>The processing makes it possible to divide the upgrade into parallelizable procedures.</li></ul>
In order to obtain the best performances possible:
<ul><li>The final table is delivered empty, and then is indexed (single index). The other indices are created at the end of the unit procedure.</li><li>It is possible to partially process the original information, as well as process non-upgraded data at a later stage (for example if you only want to upgrade the last two fiscal years).</li><li>The table is preferably written in grouped mode (using syntax <code>writeb</code>), running commit on the table for each stack of N entries (N being limited to a reasonable number).</li><li>The upgrade log is updated.</li></ul>
In order for the unit procedures to be easily interrupted and resumed:
<ul><li>A pointer is written in a dedicated table after each commit to specify what data has already been processed and provide additional information.</li><li>A test is run to check if an interruption request was made after each commit.</li><li>The procedure is written in such a way that it can be rerun starting from the empty destination tables.</li></ul>
## Description of the upgraden processing
The upgrade processing contains the following elements:
<ul><li>Preliminary lines that enable the direct triggering of the procedure.</li><li>Subprogram "RAZ_UUMGSPExxxnn" which makes it possible to return to the initial situation to restart the procedure.</li><li>Subprogram "MAJ_UUMGSPExxxnn" which contains the upgrade procedure.</li><li>Subprogram "PATCH".</li><li>Subprogram "UTI_MOUL".</li></ul>
These subprograms are described in this document.
In the given examples, processing "UUMGTRTZMY01" corresponds to the unit upgrade phase of a single table called "ZMYTABLE". After the preliminary folder revalidation phase:
<ul><li>"ZMYTABLE" has been renamed according to the default rule ("UZMYTABLE").</li><li>The new "ZMYTABLE" table has been created with the new structure but it is empty.</li></ul>
The upgrade procedure will populate table "ZMYTABLE" using the information in table "UZMYTABLE".
## Preliminary lines
The preliminary lines directly start the processing from the editor using the <b>Execution</b> function:
<pre xml:space="preserve"># Definition of the current folder, and read of the folder table
Local Char FOLDER(30): FOLDER = nomap
# Name of the upgrade procedure
Local Char PROG(20): PROG="UUMGTRTZMY01"
If !GSERVEUR
  Call SAIDOS(FOLDER,"") From SAIDOS
Endif
If FOLDER&lt;&gt; ""
  If clalev([F:ADS])=0: Local File ADOSSIER [ADS]: Endif
  Read [ADS] DOSSIER=[L]FOLDER: If fstat: Raz [F:ADS]: Endif
  # Opening of the log and display of a timing window
  If !GSERVEUR
    Call TEMPON("O") From GESECRAN
    Call OUVRE_TRACE(PROG) From LECFIC
  Endif
  # Launching of the procedure
  Call MAJ_UUMGSPEZMA00(FOLDER)
  # Closing the log
  If !GSERVEUR
    Call TEMPOFF     From GESECRAN
    Call FERME_TRACE From LECFIC
    Call LEC_TRACE From LECFIC
  Endif
Endif
End</pre>
## Reset to zero subprogram
The subprogram declared by "Subprog RAZ_UUMGTRTZMY01(FOLDER)" allows you to revert to the initial situation, if necessary, in order to relaunch the procedure. It must at least include the following basic phases:
<ul><li>Make sure the original and destination tables exist using the following lines:<br /><pre xml:space="preserve"># Find the original table for the table to populate (here UZMYTABLE)
      Call MIGTABNAME(FOLDER,"ZMYTABLE",OLDTABLE,ERR) From TRTMIG
      If ERR: End: Endif
      # Does the table of origin really exist?
      If filinfo(filpath("FIL",OLDTABLE,"fde",[F:ADS]DOSSIER),0)&lt;0
           End
      Endif</pre></li><li>Generate logs for errors only (no progress or warning messages).</li><li>Empty the tables where the update procedure inserts data using the following subprogram:
<pre xml:space="preserve">      # Sudden and irreversible dump of table ZMYTABLE
      Call MIGTABRAZ(FOLDER,"ZMYTABLE",ERR)
      If ERR: End: Endif</pre></li><li>Use standard transactions such as the ones listed below if common tables with several processing routines must be partially purged:
<pre xml:space="preserve">       Trbegin [...]: Delete [...] Where ... : Commit</pre></li><li>Reset the information regarding the already upgraded flow for this table to zero using the following subprogram:
<pre xml:space="preserve">      # No upgraded lines at the moment
      Call MIGRAZKEY(FOLDER,"UUMGTRTZMY01",ERR) From TRTMIG</pre></li></ul>
## Update subprogram
Subprogram "MAJ_UUMGTRTZMY01" is used to transcodify the content of table "UZMYTABLE" to populate table "ZMYTABLE". It performs the following tasks:
<ol><li value="1">Define the name of the upgrade procedure at the beginning:
<pre xml:space="preserve">Local Char PROG(20): PROG="UUMGTRTZMY01"</pre></li><li value="2">Update the status of the procedure using the following subprogram:
<pre xml:space="preserve">      # CURSTAT variable Integer managing the status (local menu 21)
# The possible values are Pending, In progress, Completed... 
      # If the procedure is launched, CURSTAT=2
      # If it is over, CURSTAT=3
      # In case of error, it will need to be set to 7
      # Variable PROG contains the name of the procedure
      #  (for example, UUMGTRTZMY01)
      Call MIGSTKENDFLG (FOLDER,PROG,CURSTAT,ERR) From TRTMIG</pre><b>Note:</b> If a preliminary condition makes the launch unnecessary, the status needs to be "Completed" for the procedure to be considered as running and for the next procedures to follow. Otherwise, the status is set to "In progress"</li><li value="3">Test the presence of the current and previous tables using subprogram "MIGTABNAME". In case of error, the status of the task has to be set to the correct value ("7") with subprogram "MIGSTKENDFLG".
</li><li value="4">Open the tables necessary for the upgrade. The internal tables of the upgrade procedure are opened using:  
<pre xml:space="preserve">  Call MIG_OUVRE From TRTMIG</pre></li><li value="5">Keep logs to a minimum. Adding a log to each line can cause a lack of disk space, which can interrupt the upgrades. However, it is useful to create a log starting with "Start of the phase updating xxx", and a time stamp starting with "Process started at". These logs will use the following subprograms:  
<pre xml:space="preserve">      # Log line if ERR=0, else, error line
      Call ECR_TRACE("message",ERR) From GESECRAN
      # Time stamped log line
      Call ECR_TIME("message") From DOSSUB</pre></li><li value="6">Delete indices to improve the insertion time in tables. Only the first active index is kept at the beginning of the procedure. The indices are recreated at the end of the procedure, using the following subprograms:
<pre xml:space="preserve">  Call MIGTABINIT(FOLDER,"ZMYTABLE",ERR) From TRTMIG</pre><b>Caution:</b> The procedure has to be the only operating procedure in the table when it is run. No other procedure must be read, modified, or inserted in the table while the procedure is run. If the table has to be accessed by several procedures, this subprogram must not be used.
</li><li value="7">Find the first key to be processed in the processing loop using the following subprogram:
<pre xml:space="preserve">       # TBMKEY(1..NBMKEY) is a table containing the key values
       #   where to resume the read. At a minimum, the components
       #   of the last processed key value are included, but the following can be added
       #   a segment to determine the break level reached
       #   on a multiple key. TBMKEY must be empty before the call
       #   If it is returned empty, it means that there was no current key value
       #   (the procedure is then started at the beginning).
       # NBMKEY is used to define the number of expected values
       # NBL and NBUP count the number of lines read and updated so far.
  Call MIGGETKEY (FOLDER,PROG,NBMKEY,TBMKEY,NBL,NBUP,ERR)
       &amp;    From TRTMIG</pre>
It is not empty when the upgrade resumes after an interruption.
</li><li value="8">Enter the <code>read</code> loop of the original tables and the <code>write</code> loop of the destination tables. For performance reasons, it is recommended to avoid the use of isolated read orders on tables. It is also recommended to use <code>link</code> instructions instead, preferably with strict joins (syntax <code>Where CLE~=...</code> ). If a "smaller" table (containing less than 1,000 lines) must be read for initialization or control reasons, it is usually better to store the useful content of this table in variables before starting the loop.
</li><li value="9">Avoid writing an overly large number of lines which can cause errors. To do this, the number of lines is counted and the loop is interrupted every N lines. For example, N can be set to 50,000, using global variable <code>GMAXUPDTRS</code>.
</li><li value="10">Use the <code>writeb</code> instruction for performance reasons. This instruction groups the records and improves performances, especially for multi-tier architectures. It can only be used if the table is not re-read in the loop. It implies that a grouping factor is set using a variable named <code>adxwrb</code> ("10" is an appropriate value). It is then necessary to stack the values of the written keys to be able to retrieve all the keys currently being used in case of error (this error is generated with the <code>flush</code> instruction and not the <code>writeb</code> instruction). The following subprogram can be used:
<pre xml:space="preserve">        # Stacking of keys.
        # KEY_ARRAY is an alphanumerical array declared by
        # Local Char KEY_ARRAY(N)(adxwrb)  at the beginning of the processing
        # (sizeN is dependent on the size of the key values)
        # NUMBER a variable Shortint that determines the number of stacked keys
        # KEY_VALUE encoded key value if the key is subdivided into several parts
        Call STK (KEY_ARRAY, NUMBER,KEY_VALUE) From TRTMIG</pre></li><li value="11">Perform a <code>flush</code> on the table (if <code>writeb</code> is used) by managing a possible error if the loop is exited (after N loops, or because the processing is complete). If an error has been generated and <code>adxwrb</code> is larger than "1", the keys that caused the error can be found in the "KEY_ARRAY" array, in the first <code>adxwrb</code> indices. A rollback is then run before setting the procedure to "Completed with errors" and ending the processing.
</li><li value="12">Update the number of lines read and updated using the following call:
<pre xml:space="preserve">  Call MIGSTKKEY (FOLDER,PROG,NBMKEY,TBMKEY,NBL,NBUP,ERR)
  &amp;    From TRTMIG</pre>
A commit is then performed.
</li><li value="13">Carry out an interruption request test, if necessary. In the absence of such a request, and if not all the lines have been processed, a loop is started again on N lines. The interruption test is carried out using the following subprogram:
<pre xml:space="preserve">      # The STOP variable is equal to 0 if an interruption request has been made
      Call MIGSTKPROGRESS (FOLDER,PROG,STOP,ERR) From TRTMIG</pre></li><li value="14">Conduct the following operations if an interruption request has been made (or if the processing is completed):
<pre xml:space="preserve">      # Indexing of the processed table(s)
      # (only if MIGTABINIT has been used)
         Call MIGTABEND(FOLDER,"ZMYTABLE",ERR) From TRTMIG
      # Alert the monitor of the processing end
         Call MIGTRTEND(FOLDER,PROG) From TRTMIG
         Call ECR_TIME(PROG+": Task completed") From DOSSUB</pre></li></ol>
It is then possible to close the tables and free the resources, if any, then stop the subprogram using the <code>end</code> instruction.
## PATCH subprogram
This subprogram is used to perform a launch by patch. The "ADOSSIER" table needs to be open. The record corresponding to the folder to be processed is read, and the upgrade procedure is launched. This subprogram can be organized as follows:
<pre xml:space="preserve">Subprog PATCH(FOLDER)
Value Char FOLDER
# No launch on the supervisor folder
If FOLDER=GDOSX3: End: Endif
#Loading of class [F:ADS]
If clalev([F:ADS])=0  Local File ADOSSIER [ADS]: Endif
Read [ADS] DOSSIER=FOLDER: If fstat: Raz [F:ADS]: Endif
#Launch of the procedure
Call MAJ_UUMGTRTZMY01(FOLDER)
End
</pre><h2 id="SubprogramUTIMOUL" data-magellan-target="SubprogramUTIMOUL">Subprogram UTI_MOUL</h2><p>This subprogram is used to launch folder validation. It is similar to the <b>PATCH</b> subprogram, except that table "ADOSSIER" does not need to be open, and the record corresponding to the folder to be processed does not need to be read. All this is ensured by the calling processing. Its sole purpose is to launch the corresponding procedure. This subprogram can be organized as follows:</p><pre xml:space="preserve">Subprog UTIL_MOUL(FOLDER)
Value Char FOLDER
# No launch on the supervisor folder
If FOLDER=GDOSX3: End: Endif
#Launch of the procedure
Call MAJ_UUMGTRTZMY01(FOLDER)
End</pre><h2 id="MIGTABentrypoint" data-magellan-target="MIGTABentrypoint"><a id="migtab-entry-point">MIGTAB entry point</a></h2><p>If specific transactions tables have to be managed in a similar way by the upgrade processing, the following phases are necessary:</p><ul><li>Use entry point <b>MIGTAB</b> to indicate that a specific transactions table has to be processed in the same way as the standard tables during the first phase (renaming and deletion of the unnecessary indices).</li><li>In the Supervisor folder (or the reference folder in case of a 3-tier architecture), create the description of the specific tables whose structure varies after version change. If not, the new transactions tables will not be empty with the new structure.<br />
This is an exception to the rule stating that no specific table should be created in the Supervisor folder. It is due to the fact that a "reference" dictionary is needed in this particular case. The only "reference" dictionary available for a 2-tier architecture (usual case) is the Supervisor folder dictionary. Note that the specific tables created in the Supervisor folder can be overwritten without notice if a new version of the Supervisor folder is installed. As a result, the presence of specific tables in Sage X3 is only temporary and the description of these tables must be saved elsewhere.</li><li>Since a specific table can be used to feed specific fields in a standard table, it is not necessary to create a new specific table after the version change. In this case, the specific table is renamed using entry point "MIGTAB", and entry points are used in standard or additional procedures to perform the updates that may be missing, without creating new tables in the destination dictionary.</li></ul><p>If this entry point is not used, the specific tables (which are protected by a specific activity code) will not be impacted at all, and will remain in their original state. It usually corresponds to what must be done by default if the version change has no impact on the structure of the specific tables.</p><p>Similarly, any specific field present in a standard transactions table that has content that should be transferred as such does not need to follow any specific rule. The standard upgrade processing routines use class assignments to copy data.</p><p>The name of the processing where the "MIGTAB" entry point is located depends on the software based on SAFE X3. In the case of Sage X3, entry point "MIGTAB" can be found in processing "TRTMIGTABX3".</p><p>This processing will also contain lines such as:</p><pre xml:space="preserve">    Call MIGTABTABADD(FOLDER,"ZMYTABLE","ZMY","index",
&amp;         NBTAB,WTABLE,WTABLEJ,WABRJ,WTABIDX,ERR) From TRTMIG</pre><p>With most of the variable names provided below being fixed:</p><ul><li><code>FOLDER</code> is the folder code.</li><li>The name of the table to upgrade provided as an example is "ZMYTABLE".</li><li>"ZMY" is the abbreviation of the original table after it has been renamed. If this value is empty, a temporary abbreviation is specified, in the form "U##" or "W##", where "##" is a number.<br />
In all cases, this abbreviation is not used in the processing routines. In procedures, another temporary abbreviation such as "[XXXM]" is used, with "XXX" being the abbreviation of the upgraded table.</li><li>"NBTAB" contains the number of transactions tables to be upgraded. Each call to "TRTMIG" increments this variable.</li><li>"WTABLE", "WTABLEJ", "WABRJ" and "WTABIDX" are tables that contain all the elements linked to the transactions tables that have already been declared.</li><li>"ERR" returns "0" <u>unless</u> there is an error.</li></ul><h2 id="Entrypointsofthestandardupgradeprocessingroutines" data-magellan-target="Entrypointsofthestandardupgradeprocessingroutines">Entry points of the standard upgrade processing routines</h2><p>Each standard upgrade procedure contains entry points used to interact with the switching logic of the standard tables. These entry points are the following:</p><ul><li>"CRITSEL", which is used to feed the "CRITERESPE" variable to filter the data to be processed.<br />
More details on the where-used context can be found in the <a href="getting-started_list-of-x3-upgrade-procedures-by-module-v11.html#critsel">annex describing the upgrade procedures</a>.</li><li>"VERIFSEL", which is used to recalculate fields of the original table being used during the processing, and possibly exclude a record that will not be rewritten by setting "ISVALID" to "0".<br />
More details on the where-used context can be found in the <a href="getting-started_list-of-x3-upgrade-procedures-by-module-v11.html#verifsel">annex describing the upgrade procedures</a>.</li></ul><br /></div>
                                            <div data-mc-conditions="Other.Production only">
                                                <div id="feedback-survey">
                                                    <div class="feedback-question">
                                                        <h4>Did you find this helpful?</h4>
                                                        <p>
                                                            <button class="feedback-button feedback-yes" title="Yes, this article was helpful." alt="Yes, this article was helpful.">Yes</button>&#160;<button class="feedback-button feedback-no" title="No, this article wasn't helpful." alt="No, this article wasn't helpful.">No</button></p>
                                                    </div>
                                                    <div class="feedback-reason no">
                                                        <hr />
                                                        <div class="highlightBox">
                                                            <h4>Sorry about that</h4>
                                                            <p>Why wasn't this helpful? (check all that apply)</p>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option1" value="Couldn't find what I was looking for" data-analytics-label="Could not find" />
                                                                <label for="option1">Couldn't find what I was looking for</label>
                                                            </div>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option2" value="Instructions confusing or unclear" data-analytics-label="Confusing or unclear" />
                                                                <label for="option2">Instructions confusing or unclear</label>
                                                            </div>
                                                            <div class="feedback-option">
                                                                <input type="checkbox" class="option no" id="option3" value="Instructions didn't work" data-analytics-label="Did not work" />
                                                                <label for="option3">Instructions didn't work</label>
                                                            </div>
                                                            <div class="feedback-reason no-thanks">
                                                                <p><b>Thanks for your feedback.</b>
                                                                </p>
                                                                <h4>Want to tell us more?</h4>
                                                                <p>Send an email to our authors to leave your feedback.</p>
                                                                <!--email_off-->
                                                                <p><a href="mailto:Sage200TechnicalAuthors@sage.com?subject=Sage 200 feedback" id="feedbackEmailLink" title="Tell us if there's a problem with the information on this page." alt="Tell us if there's a problem with the information on this page." class="sageButton">Email our authors</a>
                                                                </p>
                                                                <!--/email_off-->
                                                                <p>Sorry, but we can't provide technical support from this email address. If you need assistance, then please contact our support team directly.</p>
                                                            </div>
                                                        </div>
                                                        <div id="get-in-touch" class="highlightBox colour-dark-1">
                                                            <h4>Need support?</h4>
                                                            <p>You can contact our support team on <b>0845 111 5555</b>, 9am-5pm Monday-Friday.</p>
                                                        </div>
                                                    </div>
                                                    <div class="feedback-reason yes-thanks">
                                                        <hr />
                                                        <h4>Great!</h4>
                                                        <p>Thanks for taking the time to give us some feedback.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="sage-layout-topic-panel">
                                            <div class="menu-topic-container" id="menu-on-page">
                                                <ul data-magellan="" data-animation-duration="250" data-active-class="selected" data-scroll-container=".body-container" data-scroll-container-on="only screen and (min-width: 1280px)" class="nocontent menu _Skins_Sage_Menu_Topic_TopNav mc-component">
                                                    <li><a href="#Writingaspecificupgradeprocedure"> Writing a specific upgrade procedure
</a>
                                                    </li>
                                                    <ul>
                                                        <li><a href="#Basicprinciples">Basic principles</a>
                                                        </li>
                                                        <li><a href="#SubprogramUTIMOUL">Subprogram UTI_MOUL</a>
                                                        </li>
                                                        <li><a href="#MIGTABentrypoint">MIGTAB entry point</a>
                                                        </li>
                                                        <li><a href="#Entrypointsofthestandardupgradeprocessingroutines">Entry points of the standard upgrade processing routines</a>
                                                        </li>
                                                    </ul>
                                                </ul>
                                            </div>
                                        </div>
                                    </section>
                                    <button class="go-to-top">
                                        <!-- icon and label are inserted -->
                                    </button>
                                    <section class="sage-footer colour-dark-1" id="footer" role="contentinfo">
                                        <div class="row">
                                            <div class="small-6 medium-3 columns">
                                                <h5>Site links</h5>
                                                <p><a href="../Sitemap.htm" class="MCXref xref">Sitemap</a>
                                                </p>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Sage links</h5>
                                                <p><a href="https://my.sage.co.uk/public/help.aspx" target="_blank" class="external">Sage Support Hub</a>
                                                </p>
                                                <p><a href="https://communities.sage.co.uk/product_support_community/" class="external" target="_blank" title="Your place to get product support from other customers and Sage experts" alt="Your place to get product support from other customers and Sage experts">Product support community</a>
                                                </p>
                                                <p><a href="https://www.sage.com/en-gb/gdpr/" class="external" target="_blank">General Data Protection Regulation</a>
                                                </p>
                                                <p><a href="https://www.sage.com/en-gb/legal/" class="external" target="_blank">Legal information</a>
                                                </p>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Page info</h5>
                                                <p>Page updated: <span class="mc-variable Dates.DateFileSaved variable">26 febrero 2024</span></p>
                                                <!-- script moves last published date to here -->
                                                <div id="last-published-footer">
                                                </div>
                                            </div>
                                            <div class="small-6 medium-3 columns">
                                                <h5>Sage media</h5>
                                                <p><a href="https://www.facebook.com/sageuk" target="_blank" alt="Find us on Facebook" title="Find us on Facebook"><i class="fa fa-lg fa-facebook" aria-hidden="true"></i></a>&#160;
						<a href="https://www.linkedin.com/company/sage-software" target="_blank" alt="Find us on LinkedIn" title="Find us on LinkedIn"><i class="fa fa-lg fa-linkedin" aria-hidden="true"></i></a>&#160;
						<a href="https://twitter.com/sageuk/" target="_blank" alt="Find us on Twitter" title="Find us on Twitter"><i class="fa fa-lg fa-twitter" aria-hidden="true"></i></a>&#160;
						<a href="https://www.youtube.com/user/SageUKOfficial" target="_blank" alt="Find us on YouTube" title="Find us on YouTube"><i class="fa fa-lg fa-youtube" aria-hidden="true"></i></a></p>
                                            </div>
                                        </div>
                                    </section>
                                    <!-- Skin type scripts -->
                                    <script type="text/javascript" src="../Resources/Scripts/SideNav-template.js" data-mc-conditions="Other.HTML5-SideNav">
                                    </script>
                                    <!-- Google Analytics -->
                                    <div data-mc-conditions="Other.Production only">
                                        <!-- Google analytics script -->
                                        <!-- Copy and paste full HTML of tracking code here for Global site tag (gtag.js) -->
                                        <!-- Remember to edit 'async' parameter to read async="" -->
                                        <!-- Analytics for events -->
                                        <script type="text/javascript" src="../Resources/Scripts/google-analytics-events.js">
                                        </script>
                                    </div>
                                    <!-- cookies -->
                                    <script src="../Resources/Scripts/jquery.cookiesdirective.sage.js">
                                    </script>
                                    <script src="../Resources/Scripts/jquery.cookiesdirective.sage.config.js">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>